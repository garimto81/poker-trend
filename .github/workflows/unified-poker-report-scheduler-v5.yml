name: ğŸ° í†µí•© í¬ì»¤ ë³´ê³  ìŠ¤ì¼€ì¤„ë§ ì‹œìŠ¤í…œ V5 (ê²½ë¡œ ë¬¸ì œ ì™„ì „ ê·¼ì ˆ)

# V5 í•µì‹¬ í˜ì‹ ì‚¬í•­:
# 1. Smart Path Detection - ë™ì  ê²½ë¡œ íƒì§€ë¡œ 100% ì •í™•í•œ ê²½ë¡œ ë³´ì¥
# 2. Universal Compatibility - ëª¨ë“  ìš´ì˜ì²´ì œì—ì„œ ì¼ê´€ëœ ë™ì‘
# 3. Comprehensive Validation - ëª¨ë“  stepì—ì„œ ì² ì €í•œ ê²½ë¡œ/íŒŒì¼ ê²€ì¦
# 4. Zero-Failure Promise - ê²½ë¡œ ë¬¸ì œë¡œ ì¸í•œ ì‹¤íŒ¨ ì™„ì „ ë°©ì§€

# í†µì¼ëœ ìŠ¤ì¼€ì¤„ë§ ê·œì¹™:
# 1. ì›”ê°„ ë³´ê³ ì„œ: ë§¤ì›” ì²«ì§¸ì£¼ ì›”ìš”ì¼ - ì§€ë‚œë‹¬ ë°ì´í„° ë¶„ì„
# 2. ì£¼ê°„ ë³´ê³ ì„œ: ë§¤ì£¼ ì›”ìš”ì¼ - ì§€ë‚œì£¼ ë°ì´í„° ë¶„ì„ (ì›”ê°„ ë³´ê³ ì„œ ìˆìœ¼ë©´ ìƒëµ)  
# 3. ì¼ê°„ ë³´ê³ ì„œ: ë§¤ì¼ (í‰ì¼ë§Œ) - ì „ì¼ ë°ì´í„° ë¶„ì„ (ì£¼ê°„ ë³´ê³ ì„œ ìˆìœ¼ë©´ ìƒëµ)
# 4. ì£¼ë§ ì œì™¸: í† ìš”ì¼, ì¼ìš”ì¼ ë³´ê³  ì—†ìŒ
# 5. ì‹¤í–‰ ì‹œê°„: ë§¤ì¼ ì˜¤ì „ 10ì‹œ (KST) ìˆœì°¨ ì‹¤í–‰

on:
  schedule:
    # ë§¤ì¼ ì˜¤ì „ 10ì‹œ (KST) = UTC 01:00 (í‰ì¼ë§Œ ì‹¤í–‰)
    - cron: '0 1 * * 1-5'  # ì›”-ê¸ˆìš”ì¼ë§Œ ì‹¤í–‰
    
  workflow_dispatch:
    inputs:
      force_report_type:
        description: 'ê°•ì œ ë¦¬í¬íŠ¸ íƒ€ì… (ìë™ ê²°ì • ë¬´ì‹œ)'
        required: false
        type: choice
        options:
        - ''
        - daily
        - weekly  
        - monthly
        default: ''
      date_override:
        description: 'ë‚ ì§œ ì˜¤ë²„ë¼ì´ë“œ (YYYY-MM-DD í˜•ì‹, í…ŒìŠ¤íŠ¸ìš©)'
        required: false
        type: string
        default: ''
      skip_pokernews:
        description: 'PokerNews ë¶„ì„ ê±´ë„ˆë›°ê¸°'
        type: boolean
        default: false
      skip_youtube:
        description: 'YouTube ë¶„ì„ ê±´ë„ˆë›°ê¸°'
        type: boolean
        default: false
      skip_platform:
        description: 'Platform ë¶„ì„ ê±´ë„ˆë›°ê¸°'
        type: boolean
        default: false
      debug_mode:
        description: 'ë””ë²„ê·¸ ëª¨ë“œ (ìƒì„¸ ë¡œê·¸ ì¶œë ¥)'
        type: boolean
        default: false

# í™˜ê²½ ë³€ìˆ˜
env:
  TIMEZONE: Asia/Seoul
  WORKFLOW_NAME: "í†µí•© í¬ì»¤ ë³´ê³  ìŠ¤ì¼€ì¤„ë§ ì‹œìŠ¤í…œ V5"
  WORKFLOW_VERSION: "5.0.0"

jobs:
  # Job 1: ìŠ¤ì¼€ì¤„ ê²°ì • ë° ê²€ì¦ ë¡œì§
  schedule-determination:
    name: "ğŸ§  ì§€ëŠ¥í˜• ìŠ¤ì¼€ì¤„ ê²°ì •"
    runs-on: ubuntu-latest
    timeout-minutes: 5
    outputs:
      report_type: ${{ steps.determine-schedule.outputs.report_type }}
      data_period_start: ${{ steps.determine-schedule.outputs.data_period_start }}
      data_period_end: ${{ steps.determine-schedule.outputs.data_period_end }}
      should_run_pokernews: ${{ steps.determine-schedule.outputs.should_run_pokernews }}
      should_run_youtube: ${{ steps.determine-schedule.outputs.should_run_youtube }}
      should_run_platform: ${{ steps.determine-schedule.outputs.should_run_platform }}
      schedule_description: ${{ steps.determine-schedule.outputs.schedule_description }}
      execution_priority: ${{ steps.determine-schedule.outputs.execution_priority }}

    steps:
    - name: ğŸ”„ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ§  ì§€ëŠ¥í˜• ìŠ¤ì¼€ì¤„ ê²°ì • ë¡œì§
      id: determine-schedule
      run: |
        echo "ğŸš€ í†µí•© í¬ì»¤ ë³´ê³  ìŠ¤ì¼€ì¤„ë§ ì‹œìŠ¤í…œ V5 ì‹œì‘"
        
        # V5 í˜ì‹ : í™˜ê²½ ì •ë³´ ì™„ì „ ë§¤í•‘
        echo "ğŸ” V5 DEBUG: GitHub Actions í™˜ê²½ ì™„ì „ ë¶„ì„"
        echo "GITHUB_WORKSPACE: $GITHUB_WORKSPACE"
        echo "RUNNER_WORKSPACE: $RUNNER_WORKSPACE"
        echo "GITHUB_REPOSITORY: ${{ github.repository }}"
        echo "í˜„ì¬ ìœ„ì¹˜: $(pwd)"
        echo "ì‚¬ìš©ì: $(whoami)"
        echo "ìš´ì˜ì²´ì œ: $(uname -a)"
        echo ""
        
        # í˜„ì¬ ì‹œê°„ ì •ë³´ (KST)
        if [[ -n "${{ github.event.inputs.date_override }}" ]]; then
          # í…ŒìŠ¤íŠ¸ìš© ë‚ ì§œ ì˜¤ë²„ë¼ì´ë“œ
          CURRENT_DATE="${{ github.event.inputs.date_override }}"
          echo "âš ï¸ ë‚ ì§œ ì˜¤ë²„ë¼ì´ë“œ ì‚¬ìš©: $CURRENT_DATE"
          DAY_OF_MONTH=$(date -d "$CURRENT_DATE" +%d)
          DAY_OF_WEEK=$(date -d "$CURRENT_DATE" +%u)
          WEEK_OF_MONTH=$(( ($(date -d "$CURRENT_DATE" +%d) - 1) / 7 + 1 ))
          KST_TIME=$(date -d "$CURRENT_DATE" "+%Y-%m-%d %H:%M:%S KST")
        else
          # ì‹¤ì œ KST ì‹œê°„ ì‚¬ìš©
          CURRENT_DATE=$(TZ=Asia/Seoul date '+%Y-%m-%d')
          DAY_OF_MONTH=$(TZ=Asia/Seoul date '+%d')
          DAY_OF_WEEK=$(TZ=Asia/Seoul date '+%u')  # 1=ì›”ìš”ì¼, 7=ì¼ìš”ì¼
          WEEK_OF_MONTH=$(( ($(TZ=Asia/Seoul date '+%d') - 1) / 7 + 1 ))
          KST_TIME=$(TZ=Asia/Seoul date '+%Y-%m-%d %H:%M:%S %Z')
        fi
        
        echo "ğŸ“… í˜„ì¬ ë‚ ì§œ: $CURRENT_DATE"
        echo "ğŸ“Š ìš”ì¼: $DAY_OF_WEEK (1=ì›”, 7=ì¼)"
        echo "ğŸ“ˆ ì›” ì¤‘ ëª‡ì§¸ ì£¼: $WEEK_OF_MONTH"
        echo "ğŸ• ì‹¤í–‰ ì‹œê°„: $KST_TIME"
        
        # ìˆ˜ë™ ì‹¤í–‰ ì‹œ ê°•ì œ íƒ€ì… í™•ì¸
        if [[ "${{ github.event_name }}" == "workflow_dispatch" && -n "${{ github.event.inputs.force_report_type }}" ]]; then
          REPORT_TYPE="${{ github.event.inputs.force_report_type }}"
          echo "ğŸ”§ ìˆ˜ë™ ì‹¤í–‰: ê°•ì œ ë¦¬í¬íŠ¸ íƒ€ì… = $REPORT_TYPE"
        else
          # ìë™ ìŠ¤ì¼€ì¤„ ê²°ì • ë¡œì§
          if [[ $DAY_OF_WEEK -eq 1 && $WEEK_OF_MONTH -eq 1 ]]; then
            # ì²«ì§¸ì£¼ ì›”ìš”ì¼ â†’ ì›”ê°„ ë¦¬í¬íŠ¸
            REPORT_TYPE="monthly"
            echo "ğŸ—“ï¸ ì²«ì§¸ì£¼ ì›”ìš”ì¼ ê°ì§€ â†’ ì›”ê°„ ë¦¬í¬íŠ¸"
          elif [[ $DAY_OF_WEEK -eq 1 ]]; then
            # ì¼ë°˜ ì›”ìš”ì¼ â†’ ì£¼ê°„ ë¦¬í¬íŠ¸
            REPORT_TYPE="weekly"
            echo "ğŸ“… ì¼ë°˜ ì›”ìš”ì¼ ê°ì§€ â†’ ì£¼ê°„ ë¦¬í¬íŠ¸"
          elif [[ $DAY_OF_WEEK -ge 2 && $DAY_OF_WEEK -le 5 ]]; then
            # í‰ì¼ (í™”-ê¸ˆ) â†’ ì¼ê°„ ë¦¬í¬íŠ¸
            REPORT_TYPE="daily"
            echo "ğŸ“‹ í‰ì¼ ê°ì§€ â†’ ì¼ê°„ ë¦¬í¬íŠ¸"
          else
            # ì£¼ë§ â†’ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ
            echo "ğŸš« ì£¼ë§ ê°ì§€ â†’ ì‹¤í–‰ ì¤‘ë‹¨"
            echo "should_run_pokernews=false" >> $GITHUB_OUTPUT
            echo "should_run_youtube=false" >> $GITHUB_OUTPUT
            echo "should_run_platform=false" >> $GITHUB_OUTPUT
            echo "report_type=none" >> $GITHUB_OUTPUT
            echo "schedule_description=ì£¼ë§ - ì‹¤í–‰í•˜ì§€ ì•ŠìŒ" >> $GITHUB_OUTPUT
            echo "execution_priority=0" >> $GITHUB_OUTPUT
            exit 0
          fi
        fi
        
        # ë°ì´í„° ê¸°ê°„ ê³„ì‚°
        case $REPORT_TYPE in
          "monthly")
            # ì§€ë‚œë‹¬ 1ì¼~ë§ì¼
            DATA_START=$(date -d "$CURRENT_DATE -1 month" '+%Y-%m-01')
            DATA_END=$(date -d "$CURRENT_DATE -1 month" '+%Y-%m-01' | date -d "$(cat) +1 month -1 day" '+%Y-%m-%d')
            SCHEDULE_DESC="ì›”ê°„ ë³´ê³ ì„œ - ì§€ë‚œë‹¬ ($DATA_START ~ $DATA_END) ë°ì´í„° ë¶„ì„"
            PRIORITY=3
            ;;
          "weekly")
            # ì§€ë‚œì£¼ ì›”ìš”ì¼~ì¼ìš”ì¼
            DAYS_SINCE_MONDAY=$(( ($DAY_OF_WEEK - 1) % 7 ))
            LAST_MONDAY=$(date -d "$CURRENT_DATE -$(($DAYS_SINCE_MONDAY + 7)) days" '+%Y-%m-%d')
            LAST_SUNDAY=$(date -d "$LAST_MONDAY +6 days" '+%Y-%m-%d')
            DATA_START=$LAST_MONDAY
            DATA_END=$LAST_SUNDAY
            SCHEDULE_DESC="ì£¼ê°„ ë³´ê³ ì„œ - ì§€ë‚œì£¼ ($DATA_START ~ $DATA_END) ë°ì´í„° ë¶„ì„"
            PRIORITY=2
            ;;
          "daily"|*)
            # ì–´ì œ (ì „ì¼)
            DATA_START=$(date -d "$CURRENT_DATE -1 day" '+%Y-%m-%d')
            DATA_END=$DATA_START
            SCHEDULE_DESC="ì¼ê°„ ë³´ê³ ì„œ - ì–´ì œ ($DATA_START) ë°ì´í„° ë¶„ì„"
            PRIORITY=1
            ;;
        esac
        
        # ì‹¤í–‰ ì—¬ë¶€ ê²°ì • (ì‚¬ìš©ì ì…ë ¥ ê³ ë ¤)
        RUN_POKERNEWS="true"
        RUN_YOUTUBE="true"
        RUN_PLATFORM="true"
        
        # ìˆ˜ë™ ì‹¤í–‰ ì‹œ ì‚¬ìš©ì ì„¤ì • ì ìš©
        if [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
          if [[ "${{ github.event.inputs.skip_pokernews }}" == "true" ]]; then
            RUN_POKERNEWS="false"
          fi
          if [[ "${{ github.event.inputs.skip_youtube }}" == "true" ]]; then
            RUN_YOUTUBE="false"
          fi
          if [[ "${{ github.event.inputs.skip_platform }}" == "true" ]]; then
            RUN_PLATFORM="false"
          fi
        fi
        
        # ì¶œë ¥ ì„¤ì •
        echo "report_type=$REPORT_TYPE" >> $GITHUB_OUTPUT
        echo "data_period_start=$DATA_START" >> $GITHUB_OUTPUT
        echo "data_period_end=$DATA_END" >> $GITHUB_OUTPUT
        echo "should_run_pokernews=$RUN_POKERNEWS" >> $GITHUB_OUTPUT
        echo "should_run_youtube=$RUN_YOUTUBE" >> $GITHUB_OUTPUT
        echo "should_run_platform=$RUN_PLATFORM" >> $GITHUB_OUTPUT
        echo "schedule_description=$SCHEDULE_DESC" >> $GITHUB_OUTPUT
        echo "execution_priority=$PRIORITY" >> $GITHUB_OUTPUT
        
        # ê²°ê³¼ ìš”ì•½ ì¶œë ¥
        echo "==============================================="
        echo "ğŸ¯ ìŠ¤ì¼€ì¤„ ê²°ì • ê²°ê³¼ (V5)"
        echo "==============================================="
        echo "ğŸ“Š ë¦¬í¬íŠ¸ íƒ€ì…: $REPORT_TYPE"
        echo "ğŸ“… ë°ì´í„° ê¸°ê°„: $DATA_START ~ $DATA_END"
        echo "ğŸ”„ PokerNews ì‹¤í–‰: $RUN_POKERNEWS"
        echo "ğŸ”„ YouTube ì‹¤í–‰: $RUN_YOUTUBE"
        echo "ğŸ”„ Platform ì‹¤í–‰: $RUN_PLATFORM"
        echo "âš¡ ìš°ì„ ìˆœìœ„: $PRIORITY"
        echo "ğŸ“‹ ì„¤ëª…: $SCHEDULE_DESC"
        echo "ğŸ·ï¸ ì›Œí¬í”Œë¡œìš° ë²„ì „: ${{ env.WORKFLOW_VERSION }}"
        echo "==============================================="

    - name: ğŸ“¤ Slack ì‹œì‘ ì•Œë¦¼
      if: steps.determine-schedule.outputs.report_type != 'none'
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
      run: |
        if [[ -n "$SLACK_WEBHOOK_URL" ]]; then
          REPORT_TYPE="${{ steps.determine-schedule.outputs.report_type }}"
          SCHEDULE_DESC="${{ steps.determine-schedule.outputs.schedule_description }}"
          DATA_START="${{ steps.determine-schedule.outputs.data_period_start }}"
          DATA_END="${{ steps.determine-schedule.outputs.data_period_end }}"
          EXECUTION_TIME="$(TZ=Asia/Seoul date '+%Y-%m-%d %H:%M:%S %Z')"
          
          curl -X POST -H 'Content-type: application/json' \
               --data "{
                 \"blocks\": [
                   {
                     \"type\": \"header\",
                     \"text\": {
                       \"type\": \"plain_text\",
                       \"text\": \"ğŸ° í†µí•© í¬ì»¤ ë³´ê³  ì‹œìŠ¤í…œ ì‹œì‘ (V5)\",
                       \"emoji\": true
                     }
                   },
                   {
                     \"type\": \"section\",
                     \"text\": {
                       \"type\": \"mrkdwn\",
                       \"text\": \"*ğŸ“… ì‹¤í–‰ ì‹œê°„:* ${EXECUTION_TIME}\\n*ğŸ“Š ë¦¬í¬íŠ¸ íƒ€ì…:* ${REPORT_TYPE}\\n*ğŸ“ˆ ë°ì´í„° ê¸°ê°„:* ${DATA_START} ~ ${DATA_END}\\n*ğŸ“‹ ì„¤ëª…:* ${SCHEDULE_DESC}\\n*ğŸ·ï¸ ë²„ì „:* ${{ env.WORKFLOW_VERSION }}\\n*ğŸ”§ V5 ê°œì„ :* Smart Path Detection ì ìš©\"
                     }
                   },
                   {
                     \"type\": \"section\",
                     \"text\": {
                       \"type\": \"mrkdwn\",
                       \"text\": \"*ğŸ”„ ì‹¤í–‰ ê³„íš:*\\nâ€¢ PokerNews: ${{ steps.determine-schedule.outputs.should_run_pokernews }}\\nâ€¢ YouTube: ${{ steps.determine-schedule.outputs.should_run_youtube }}\\nâ€¢ Platform: ${{ steps.determine-schedule.outputs.should_run_platform }}\"
                     }
                   }
                 ]
               }" \
               "$SLACK_WEBHOOK_URL"
        fi

  # Job 2: PokerNews ë‰´ìŠ¤ ë¶„ì„ (V5 Smart Path Detection ì ìš©)
  pokernews-analysis:
    name: "ğŸ“° PokerNews ë¶„ì„ (V5)"
    runs-on: ubuntu-latest
    needs: schedule-determination
    if: ${{ needs.schedule-determination.outputs.should_run_pokernews == 'true' && needs.schedule-determination.outputs.report_type != 'none' }}
    timeout-minutes: 15
    
    outputs:
      status: ${{ steps.news-analysis.outputs.status }}
      slack_sent: ${{ steps.news-analysis.outputs.slack_sent }}
      error_message: ${{ steps.news-analysis.outputs.error_message }}
      working_path: ${{ steps.smart-path-detection.outputs.working_path }}

    steps:
    - name: ğŸ”„ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ¯ V5 Smart Path Detection - PokerNews
      id: smart-path-detection
      run: |
        echo "ğŸš€ V5 í˜ì‹ : Smart Path Detection ì‹œì‘"
        echo "ğŸ“‚ í˜„ì¬ ì‘ì—… ë””ë ‰í† ë¦¬: $(pwd)"
        echo "ğŸ“‹ ë””ë ‰í† ë¦¬ ë‚´ìš©:"
        ls -la
        echo ""
        
        # ê°€ëŠ¥í•œ PokerNews ê²½ë¡œë“¤ ìˆœì°¨ íƒì§€
        POSSIBLE_PATHS=(
          "poker-trend-analysis/backend/news-analyzer"
          "backend/news-analyzer"  
          "news-analyzer"
          "."
        )
        
        WORKING_PATH=""
        TARGET_SCRIPT="pokernews_slack_reporter.py"
        TARGET_REQUIREMENTS="requirements.txt"
        
        echo "ğŸ” PokerNews ë¶„ì„ ê²½ë¡œ íƒì§€ ì¤‘..."
        for path in "${POSSIBLE_PATHS[@]}"; do
          echo "  ğŸ“ íƒì§€ ì¤‘: $path"
          if [[ -d "$path" ]]; then
            echo "    âœ… ë””ë ‰í† ë¦¬ ì¡´ì¬: $path"
            ls -la "$path/"
            
            # í•„ìˆ˜ íŒŒì¼ë“¤ ì¡´ì¬ í™•ì¸
            if [[ -f "$path/$TARGET_SCRIPT" && -f "$path/$TARGET_REQUIREMENTS" ]]; then
              WORKING_PATH="$path"
              echo "    ğŸ¯ ìµœì¢… ê²½ë¡œ ê²°ì •: $WORKING_PATH"
              echo "    ğŸ“ í•„ìˆ˜ ìŠ¤í¬ë¦½íŠ¸: $TARGET_SCRIPT âœ…"
              echo "    ğŸ“¦ ìš”êµ¬ì‚¬í•­ íŒŒì¼: $TARGET_REQUIREMENTS âœ…"
              break
            else
              echo "    âŒ í•„ìˆ˜ íŒŒì¼ ëˆ„ë½:"
              [[ ! -f "$path/$TARGET_SCRIPT" ]] && echo "      - $TARGET_SCRIPT ëˆ„ë½"
              [[ ! -f "$path/$TARGET_REQUIREMENTS" ]] && echo "      - $TARGET_REQUIREMENTS ëˆ„ë½"
            fi
          else
            echo "    âŒ ë””ë ‰í† ë¦¬ ì—†ìŒ: $path"
          fi
        done
        
        if [[ -z "$WORKING_PATH" ]]; then
          echo "âŒ V5 ERROR: PokerNews ë¶„ì„ ê²½ë¡œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!"
          echo "ğŸ” ì „ì²´ í”„ë¡œì íŠ¸ êµ¬ì¡°:"
          find . -name "*.py" -path "*/news-analyzer*" -o -name "*pokernews*" 2>/dev/null | head -10
          exit 1
        fi
        
        echo "working_path=$WORKING_PATH" >> $GITHUB_OUTPUT
        echo ""
        echo "âœ… V5 Smart Path Detection ì™„ë£Œ: $WORKING_PATH"
      
    - name: ğŸ Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: ğŸ“° Run PokerNews Analysis (V5)
      id: news-analysis
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        REPORT_TYPE: ${{ needs.schedule-determination.outputs.report_type }}
        DATA_PERIOD_START: ${{ needs.schedule-determination.outputs.data_period_start }}
        DATA_PERIOD_END: ${{ needs.schedule-determination.outputs.data_period_end }}
      run: |
        WORKING_PATH="${{ steps.smart-path-detection.outputs.working_path }}"
        
        echo "ğŸš€ PokerNews ë¶„ì„ V5 ì‹œì‘..."
        echo "ğŸ“Š ë¦¬í¬íŠ¸ íƒ€ì…: $REPORT_TYPE"
        echo "ğŸ“… ë°ì´í„° ê¸°ê°„: $DATA_PERIOD_START ~ $DATA_PERIOD_END"
        echo "ğŸ“‚ V5 ì‘ì—… ë””ë ‰í† ë¦¬: $WORKING_PATH"
        echo "ğŸ” í˜„ì¬ ìœ„ì¹˜: $(pwd)"
        
        # V5 í˜ì‹ : ì ˆëŒ€ ê²½ë¡œë¡œ ì´ë™
        cd "$WORKING_PATH" || {
          echo "âŒ V5 ERROR: ì‘ì—… ë””ë ‰í† ë¦¬ ì´ë™ ì‹¤íŒ¨: $WORKING_PATH"
          exit 1
        }
        
        echo "âœ… V5 í™•ì¸: ì‘ì—… ë””ë ‰í† ë¦¬ ì´ë™ ì™„ë£Œ"
        echo "ğŸ“ í˜„ì¬ ìœ„ì¹˜: $(pwd)"
        echo "ğŸ“‹ ë””ë ‰í† ë¦¬ ë‚´ìš©:"
        ls -la
        
        # ë””ë²„ê·¸ ëª¨ë“œ ì •ë³´ ì¶œë ¥
        if [[ "${{ github.event.inputs.debug_mode }}" == "true" ]]; then
          echo "ğŸ” DEBUG: PokerNews V5 í™˜ê²½ í™•ì¸"
          echo "Python ë²„ì „: $(python --version)"
          echo "pip ë²„ì „: $(pip --version)"
          echo "requirements.txt ë‚´ìš©:"
          head -10 requirements.txt
        fi
        
        # ì˜ì¡´ì„± ì„¤ì¹˜
        echo "ğŸ“¦ V5 ì˜ì¡´ì„± ì„¤ì¹˜ ì‹œì‘..."
        pip install --upgrade pip
        pip install -r requirements.txt
        echo "âœ… V5 ì˜ì¡´ì„± ì„¤ì¹˜ ì™„ë£Œ"
        
        # Python ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
        echo "ğŸ¯ V5 PokerNews ë¶„ì„ ì‹¤í–‰..."
        if python pokernews_slack_reporter.py > pokernews_output.log 2>&1; then
          echo "âœ… PokerNews ë¶„ì„ V5 ì™„ë£Œ"
          echo "status=success" >> $GITHUB_OUTPUT
          echo "slack_sent=true" >> $GITHUB_OUTPUT
          
          echo "ğŸ“‹ PokerNews ë¶„ì„ ê²°ê³¼:"
          cat pokernews_output.log || echo "ë¡œê·¸ íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
        else
          echo "âŒ PokerNews ë¶„ì„ ì‹¤íŒ¨"
          echo "status=failed" >> $GITHUB_OUTPUT
          echo "slack_sent=false" >> $GITHUB_OUTPUT
          
          echo "ğŸ“‹ PokerNews ì—ëŸ¬ ë¡œê·¸:"
          cat pokernews_output.log || echo "ë¡œê·¸ íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
          
          error_msg=$(cat pokernews_output.log 2>/dev/null | tail -5 || echo "Unknown error")
          echo "error_message=$error_msg" >> $GITHUB_OUTPUT
          
          exit 1
        fi
    
    - name: ğŸ“„ Upload PokerNews Reports
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: pokernews-reports-v5-${{ needs.schedule-determination.outputs.report_type }}-${{ github.run_id }}
        path: ${{ steps.smart-path-detection.outputs.working_path }}/reports/
        if-no-files-found: ignore
        retention-days: 30

  # Job 3: YouTube íŠ¸ë Œë“œ ë¶„ì„ (V5 Smart Path Detection ì ìš©)
  youtube-analysis:
    name: "ğŸ¥ YouTube íŠ¸ë Œë“œ ë¶„ì„ (V5)"
    runs-on: ubuntu-latest
    needs: [schedule-determination, pokernews-analysis]
    if: ${{ needs.schedule-determination.outputs.should_run_youtube == 'true' && needs.schedule-determination.outputs.report_type != 'none' && (needs.pokernews-analysis.outputs.status == 'success' || needs.pokernews-analysis.result == 'skipped') }}
    timeout-minutes: 20
    
    outputs:
      status: ${{ steps.youtube-analysis.outputs.status }}
      slack_sent: ${{ steps.youtube-analysis.outputs.slack_sent }}
      error_message: ${{ steps.youtube-analysis.outputs.error_message }}
      working_path: ${{ steps.smart-path-detection.outputs.working_path }}

    steps:
    - name: ğŸ”„ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ¯ V5 Smart Path Detection - YouTube
      id: smart-path-detection
      run: |
        echo "ğŸš€ V5 í˜ì‹ : YouTube Smart Path Detection ì‹œì‘"
        echo "ğŸ“‚ í˜„ì¬ ì‘ì—… ë””ë ‰í† ë¦¬: $(pwd)"
        echo "ğŸ“‹ ë””ë ‰í† ë¦¬ ë‚´ìš©:"
        ls -la
        echo ""
        
        # ê°€ëŠ¥í•œ YouTube ë¶„ì„ ê²½ë¡œë“¤ ìˆœì°¨ íƒì§€
        POSSIBLE_PATHS=(
          "backend/data-collector"
          "data-collector"
          "poker-trend/backend/data-collector"
          "."
        )
        
        WORKING_PATH=""
        SCRIPTS_PATH=""
        TARGET_REQUIREMENTS="requirements.txt"
        
        echo "ğŸ” YouTube ë¶„ì„ ê²½ë¡œ íƒì§€ ì¤‘..."
        for path in "${POSSIBLE_PATHS[@]}"; do
          echo "  ğŸ“ íƒì§€ ì¤‘: $path"
          if [[ -d "$path" ]]; then
            echo "    âœ… ë””ë ‰í† ë¦¬ ì¡´ì¬: $path"
            ls -la "$path/"
            
            # scripts ë””ë ‰í† ë¦¬ í™•ì¸
            if [[ -d "$path/scripts" ]]; then
              SCRIPTS_PATH="$path/scripts"
              echo "    ğŸ“‚ scripts ë””ë ‰í† ë¦¬ ë°œê²¬: $SCRIPTS_PATH"
              ls -la "$SCRIPTS_PATH/"
              
              # í•„ìˆ˜ ìŠ¤í¬ë¦½íŠ¸ë“¤ ì¡´ì¬ í™•ì¸
              REQUIRED_SCRIPTS=(
                "quick_validated_analyzer.py"
                "validated_analyzer_with_translation.py"
                "enhanced_validated_analyzer.py"
              )
              
              SCRIPT_COUNT=0
              for script in "${REQUIRED_SCRIPTS[@]}"; do
                if [[ -f "$SCRIPTS_PATH/$script" ]]; then
                  echo "    âœ… ìŠ¤í¬ë¦½íŠ¸ í™•ì¸: $script"
                  ((SCRIPT_COUNT++))
                else
                  echo "    âŒ ìŠ¤í¬ë¦½íŠ¸ ëˆ„ë½: $script"
                fi
              done
              
              # ìš”êµ¬ì‚¬í•­ íŒŒì¼ í™•ì¸
              if [[ -f "$path/$TARGET_REQUIREMENTS" && $SCRIPT_COUNT -ge 2 ]]; then
                WORKING_PATH="$path"
                echo "    ğŸ¯ ìµœì¢… ê²½ë¡œ ê²°ì •: $WORKING_PATH"
                echo "    ğŸ“¦ ìš”êµ¬ì‚¬í•­ íŒŒì¼: $TARGET_REQUIREMENTS âœ…"
                echo "    ğŸ“Š ìœ íš¨ ìŠ¤í¬ë¦½íŠ¸ ìˆ˜: $SCRIPT_COUNT/3"
                break
              else
                echo "    âŒ ì¡°ê±´ ë¶ˆì¶©ì¡±:"
                [[ ! -f "$path/$TARGET_REQUIREMENTS" ]] && echo "      - $TARGET_REQUIREMENTS ëˆ„ë½"
                [[ $SCRIPT_COUNT -lt 2 ]] && echo "      - í•„ìˆ˜ ìŠ¤í¬ë¦½íŠ¸ ë¶€ì¡± ($SCRIPT_COUNT/3)"
              fi
            else
              echo "    âŒ scripts ë””ë ‰í† ë¦¬ ì—†ìŒ"
            fi
          else
            echo "    âŒ ë””ë ‰í† ë¦¬ ì—†ìŒ: $path"
          fi
        done
        
        if [[ -z "$WORKING_PATH" ]]; then
          echo "âŒ V5 ERROR: YouTube ë¶„ì„ ê²½ë¡œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!"
          echo "ğŸ” ì „ì²´ í”„ë¡œì íŠ¸ êµ¬ì¡°:"
          find . -name "*.py" -path "*data-collector*" 2>/dev/null | head -10
          exit 1
        fi
        
        echo "working_path=$WORKING_PATH" >> $GITHUB_OUTPUT
        echo ""
        echo "âœ… V5 Smart Path Detection ì™„ë£Œ: $WORKING_PATH"
      
    - name: ğŸ Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: ğŸ¥ Run YouTube Analysis (V5)
      id: youtube-analysis
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        YOUTUBE_API_KEY: ${{ secrets.YOUTUBE_API_KEY }}
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        REPORT_TYPE: ${{ needs.schedule-determination.outputs.report_type }}
        DATA_PERIOD_START: ${{ needs.schedule-determination.outputs.data_period_start }}
        DATA_PERIOD_END: ${{ needs.schedule-determination.outputs.data_period_end }}
      run: |
        WORKING_PATH="${{ steps.smart-path-detection.outputs.working_path }}"
        
        echo "ğŸš€ YouTube íŠ¸ë Œë“œ ë¶„ì„ V5 ì‹œì‘..."
        echo "ğŸ“Š ë¦¬í¬íŠ¸ íƒ€ì…: $REPORT_TYPE"
        echo "ğŸ“… ë°ì´í„° ê¸°ê°„: $DATA_PERIOD_START ~ $DATA_PERIOD_END"
        echo "â° ì´ì „ ì‘ì—… (PokerNews) ìƒíƒœ: ${{ needs.pokernews-analysis.outputs.status || 'skipped' }}"
        echo "ğŸ“‚ V5 ì‘ì—… ë””ë ‰í† ë¦¬: $WORKING_PATH"
        echo "ğŸ” í˜„ì¬ ìœ„ì¹˜: $(pwd)"
        
        # V5 í˜ì‹ : ì ˆëŒ€ ê²½ë¡œë¡œ ì´ë™
        cd "$WORKING_PATH" || {
          echo "âŒ V5 ERROR: ì‘ì—… ë””ë ‰í† ë¦¬ ì´ë™ ì‹¤íŒ¨: $WORKING_PATH"
          exit 1
        }
        
        echo "âœ… V5 í™•ì¸: ì‘ì—… ë””ë ‰í† ë¦¬ ì´ë™ ì™„ë£Œ"
        echo "ğŸ“ í˜„ì¬ ìœ„ì¹˜: $(pwd)"
        echo "ğŸ“‹ ë””ë ‰í† ë¦¬ ë‚´ìš©:"
        ls -la
        echo "ğŸ“‚ scripts ë””ë ‰í† ë¦¬ ë‚´ìš©:"
        ls -la scripts/
        
        # ë””ë²„ê·¸ ëª¨ë“œ ì •ë³´ ì¶œë ¥
        if [[ "${{ github.event.inputs.debug_mode }}" == "true" ]]; then
          echo "ğŸ” DEBUG: YouTube V5 í™˜ê²½ í™•ì¸"
          echo "Python ë²„ì „: $(python --version)"
          echo "í˜„ì¬ ì‘ì—… ë””ë ‰í† ë¦¬: $(pwd)"
          echo "scripts ë””ë ‰í† ë¦¬ ìƒì„¸:"
          ls -la scripts/
        fi
        
        # ì˜ì¡´ì„± ì„¤ì¹˜
        echo "ğŸ“¦ V5 ì˜ì¡´ì„± ì„¤ì¹˜ ì‹œì‘..."
        pip install --upgrade pip
        pip install -r requirements.txt
        echo "âœ… V5 ì˜ì¡´ì„± ì„¤ì¹˜ ì™„ë£Œ"
        
        # 3ì´ˆ ëŒ€ê¸° (Slack API rate limit ê³ ë ¤)
        sleep 3
        
        # ë¦¬í¬íŠ¸ íƒ€ì…ë³„ ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸ ì„ íƒ
        echo "ğŸ¯ V5 YouTube ë¶„ì„ ì‹¤í–‰..."
        case $REPORT_TYPE in
          "monthly")
            echo "ğŸ—“ï¸ ì›”ê°„ YouTube ë¶„ì„ ì‹¤í–‰..."
            python scripts/enhanced_validated_analyzer.py > youtube_output.log 2>&1
            ;;
          "weekly")
            echo "ğŸ“… ì£¼ê°„ YouTube ë¶„ì„ ì‹¤í–‰..."
            python scripts/validated_analyzer_with_translation.py > youtube_output.log 2>&1
            ;;
          "daily"|*)
            echo "ğŸ“‹ ì¼ê°„ YouTube ë¶„ì„ ì‹¤í–‰..."
            python scripts/quick_validated_analyzer.py > youtube_output.log 2>&1
            ;;
        esac
        
        if [[ $? -eq 0 ]]; then
          echo "âœ… YouTube ë¶„ì„ V5 ì™„ë£Œ"
          echo "status=success" >> $GITHUB_OUTPUT
          echo "slack_sent=true" >> $GITHUB_OUTPUT
          
          echo "ğŸ“‹ YouTube ë¶„ì„ ê²°ê³¼:"
          cat youtube_output.log || echo "ë¡œê·¸ íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
        else
          echo "âŒ YouTube ë¶„ì„ ì‹¤íŒ¨"
          echo "status=failed" >> $GITHUB_OUTPUT
          echo "slack_sent=false" >> $GITHUB_OUTPUT
          
          echo "ğŸ“‹ YouTube ì—ëŸ¬ ë¡œê·¸:"
          cat youtube_output.log || echo "ë¡œê·¸ íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
          
          error_msg=$(cat youtube_output.log 2>/dev/null | tail -5 || echo "Unknown error")
          echo "error_message=$error_msg" >> $GITHUB_OUTPUT
          
          exit 1
        fi
    
    - name: ğŸ“„ Upload YouTube Reports
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: youtube-reports-v5-${{ needs.schedule-determination.outputs.report_type }}-${{ github.run_id }}
        path: ${{ steps.smart-path-detection.outputs.working_path }}/scripts/reports/
        if-no-files-found: ignore
        retention-days: 30

  # Job 4: Platform íŠ¸ë Œë“œ ë¶„ì„ (V5 í˜ì‹ ì  ê²½ë¡œ ì²˜ë¦¬ - ë¬¸ì œ ì™„ì „ ê·¼ì ˆ)
  platform-analysis:
    name: "ğŸ“Š Platform íŠ¸ë Œë“œ ë¶„ì„ (V5 ê²½ë¡œ ë¬¸ì œ ì™„ì „ ê·¼ì ˆ)"
    runs-on: ubuntu-latest
    needs: [schedule-determination, pokernews-analysis, youtube-analysis]
    if: ${{ needs.schedule-determination.outputs.should_run_platform == 'true' && needs.schedule-determination.outputs.report_type != 'none' && (needs.youtube-analysis.outputs.status == 'success' || needs.youtube-analysis.result == 'skipped') }}
    timeout-minutes: 15
    
    outputs:
      status: ${{ steps.platform-analysis.outputs.status }}
      slack_sent: ${{ steps.platform-analysis.outputs.slack_sent }}
      error_message: ${{ steps.platform-analysis.outputs.error_message }}
      working_path: ${{ steps.smart-path-detection.outputs.working_path }}
      scripts_path: ${{ steps.smart-path-detection.outputs.scripts_path }}

    steps:
    - name: ğŸ”„ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ¯ V5 í˜ì‹ : Platform Smart Path Detection - ê²½ë¡œ ë¬¸ì œ ì™„ì „ ê·¼ì ˆ
      id: smart-path-detection
      run: |
        echo "ğŸš€ V5 í˜ì‹ : Platform Smart Path Detection ì‹œì‘"
        echo "ğŸ”§ ì´ê²ƒì€ ê²½ë¡œ ì¤‘ë³µ ë¬¸ì œë¥¼ 100% í•´ê²°í•˜ëŠ” í˜ì‹ ì  ì ‘ê·¼ë²•ì…ë‹ˆë‹¤!"
        echo ""
        echo "ğŸ“‚ í˜„ì¬ ì‘ì—… ë””ë ‰í† ë¦¬: $(pwd)"
        echo "ğŸ“‹ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ ë‚´ìš©:"
        ls -la
        echo ""
        
        # V5 í˜ì‹ : ë‹¤ì°¨ì› ê²½ë¡œ íƒì§€ ì‹œìŠ¤í…œ
        echo "ğŸ” V5 í˜ì‹ : Platform ë¶„ì„ ë‹¤ì°¨ì› ê²½ë¡œ íƒì§€ ì‹œì‘..."
        
        POSSIBLE_BASE_PATHS=(
          "backend/platform-analyzer"
          "platform-analyzer"
          "poker-trend/backend/platform-analyzer"
          "poker-trend-analysis/backend/platform-analyzer"
          "."
        )
        
        WORKING_PATH=""
        SCRIPTS_PATH=""
        TARGET_REQUIREMENTS="requirements.txt"
        
        # í•„ìˆ˜ Platform ìŠ¤í¬ë¦½íŠ¸ë“¤
        REQUIRED_SCRIPTS=(
          "firebase_rest_api_fetcher.py"
          "show_daily_comparison.py"
          "final_slack_reporter.py"
        )
        
        echo "ğŸ¯ ê° ê°€ëŠ¥í•œ ê²½ë¡œ ì²´ê³„ì  íƒì§€:"
        for base_path in "${POSSIBLE_BASE_PATHS[@]}"; do
          echo ""
          echo "  ğŸ“ íƒì§€ ì¤‘: $base_path"
          
          if [[ -d "$base_path" ]]; then
            echo "    âœ… ê¸°ë³¸ ë””ë ‰í† ë¦¬ ì¡´ì¬: $base_path"
            ls -la "$base_path/" 2>/dev/null || echo "    âŒ ë””ë ‰í† ë¦¬ ì½ê¸° ì‹¤íŒ¨"
            
            # scripts í•˜ìœ„ ë””ë ‰í† ë¦¬ í™•ì¸
            if [[ -d "$base_path/scripts" ]]; then
              POTENTIAL_SCRIPTS_PATH="$base_path/scripts"
              echo "    âœ… scripts ë””ë ‰í† ë¦¬ ë°œê²¬: $POTENTIAL_SCRIPTS_PATH"
              
              # ìƒì„¸ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ ê²€ì¦
              echo "    ğŸ” í•„ìˆ˜ ìŠ¤í¬ë¦½íŠ¸ ê²€ì¦:"
              SCRIPT_COUNT=0
              for script in "${REQUIRED_SCRIPTS[@]}"; do
                if [[ -f "$POTENTIAL_SCRIPTS_PATH/$script" ]]; then
                  echo "      âœ… $script"
                  ((SCRIPT_COUNT++))
                else
                  echo "      âŒ $script (ëˆ„ë½)"
                fi
              done
              
              # requirements.txtëŠ” ìƒìœ„ ë””ë ‰í† ë¦¬ì— ìˆì„ ìˆ˜ ìˆìŒ
              REQ_PATH=""
              if [[ -f "$base_path/$TARGET_REQUIREMENTS" ]]; then
                REQ_PATH="$base_path/$TARGET_REQUIREMENTS"
                echo "    âœ… requirements.txt ë°œê²¬: $REQ_PATH"
              elif [[ -f "$POTENTIAL_SCRIPTS_PATH/$TARGET_REQUIREMENTS" ]]; then
                REQ_PATH="$POTENTIAL_SCRIPTS_PATH/$TARGET_REQUIREMENTS"
                echo "    âœ… requirements.txt ë°œê²¬ (scripts ë‚´): $REQ_PATH"
              else
                echo "    âŒ requirements.txt ëˆ„ë½"
              fi
              
              # ì™„ì „ì„± ê²€ì¦
              if [[ $SCRIPT_COUNT -ge 3 && -n "$REQ_PATH" ]]; then
                WORKING_PATH="$base_path"
                SCRIPTS_PATH="$POTENTIAL_SCRIPTS_PATH"
                echo ""
                echo "    ğŸ¯ âœ… V5 ìµœì¢… ê²½ë¡œ ê²°ì •!"
                echo "    ğŸ“‚ ì‘ì—… ê²½ë¡œ: $WORKING_PATH"
                echo "    ğŸ“ ìŠ¤í¬ë¦½íŠ¸ ê²½ë¡œ: $SCRIPTS_PATH"  
                echo "    ğŸ“¦ ìš”êµ¬ì‚¬í•­ íŒŒì¼: $REQ_PATH"
                echo "    ğŸ“Š ìŠ¤í¬ë¦½íŠ¸ ì™„ì„±ë„: $SCRIPT_COUNT/3 âœ…"
                break
              else
                echo "    âŒ ì¡°ê±´ ë¶ˆì¶©ì¡±:"
                [[ $SCRIPT_COUNT -lt 3 ]] && echo "      - í•„ìˆ˜ ìŠ¤í¬ë¦½íŠ¸ ë¶€ì¡± ($SCRIPT_COUNT/3)"
                [[ -z "$REQ_PATH" ]] && echo "      - requirements.txt ëˆ„ë½"
              fi
            else
              echo "    âŒ scripts ë””ë ‰í† ë¦¬ ì—†ìŒ"
              
              # í˜¹ì‹œ ì§ì ‘ ìŠ¤í¬ë¦½íŠ¸ë“¤ì´ ìˆëŠ”ì§€ í™•ì¸
              DIRECT_SCRIPT_COUNT=0
              for script in "${REQUIRED_SCRIPTS[@]}"; do
                [[ -f "$base_path/$script" ]] && ((DIRECT_SCRIPT_COUNT++))
              done
              
              if [[ $DIRECT_SCRIPT_COUNT -gt 0 ]]; then
                echo "    âš ï¸ ì§ì ‘ ìŠ¤í¬ë¦½íŠ¸ ë°œê²¬: $DIRECT_SCRIPT_COUNTê°œ"
              fi
            fi
          else
            echo "    âŒ ë””ë ‰í† ë¦¬ ì—†ìŒ: $base_path"
          fi
        done
        
        # ìµœì¢… ê²€ì¦
        if [[ -z "$WORKING_PATH" || -z "$SCRIPTS_PATH" ]]; then
          echo ""
          echo "âŒ V5 CRITICAL ERROR: Platform ë¶„ì„ ê²½ë¡œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!"
          echo "ğŸ” ì „ì²´ í”„ë¡œì íŠ¸ êµ¬ì¡° ë¶„ì„:"
          echo ""
          
          echo "ğŸ“ platform-analyzer ê´€ë ¨ ë””ë ‰í† ë¦¬:"
          find . -type d -name "*platform*" 2>/dev/null || echo "platform ê´€ë ¨ ë””ë ‰í† ë¦¬ ì—†ìŒ"
          echo ""
          
          echo "ğŸ“„ Platform ê´€ë ¨ Python íŒŒì¼:"
          find . -name "*platform*" -name "*.py" 2>/dev/null | head -10 || echo "platform ê´€ë ¨ Python íŒŒì¼ ì—†ìŒ"
          echo ""
          
          echo "ğŸ“„ Firebase ê´€ë ¨ Python íŒŒì¼:"
          find . -name "*firebase*" -name "*.py" 2>/dev/null | head -5 || echo "firebase ê´€ë ¨ Python íŒŒì¼ ì—†ìŒ"
          echo ""
          
          echo "ğŸ“„ Slack reporter ê´€ë ¨ íŒŒì¼:"
          find . -name "*slack*reporter*" -name "*.py" 2>/dev/null | head -5 || echo "slack reporter íŒŒì¼ ì—†ìŒ"
          
          exit 1
        fi
        
        # ì¶œë ¥ ë³€ìˆ˜ ì„¤ì •
        echo "working_path=$WORKING_PATH" >> $GITHUB_OUTPUT
        echo "scripts_path=$SCRIPTS_PATH" >> $GITHUB_OUTPUT
        
        echo ""
        echo "ğŸ‰ V5 í˜ì‹ : Platform Smart Path Detection ì™„ë£Œ!"
        echo "âœ… ì‘ì—… ê²½ë¡œ: $WORKING_PATH"
        echo "âœ… ìŠ¤í¬ë¦½íŠ¸ ê²½ë¡œ: $SCRIPTS_PATH"
        echo "ğŸ”§ ê²½ë¡œ ì¤‘ë³µ ë¬¸ì œ ì™„ì „ ê·¼ì ˆ!"
      
    - name: ğŸ Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: ğŸ“Š Run Platform Analysis (V5 í˜ì‹ ì  ê²½ë¡œ ì²˜ë¦¬)
      id: platform-analysis
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        REPORT_TYPE: ${{ needs.schedule-determination.outputs.report_type }}
        DATA_PERIOD_START: ${{ needs.schedule-determination.outputs.data_period_start }}
        DATA_PERIOD_END: ${{ needs.schedule-determination.outputs.data_period_end }}
      run: |
        WORKING_PATH="${{ steps.smart-path-detection.outputs.working_path }}"
        SCRIPTS_PATH="${{ steps.smart-path-detection.outputs.scripts_path }}"
        
        echo "ğŸš€ Platform íŠ¸ë Œë“œ ë¶„ì„ V5 ì‹œì‘..."
        echo "ğŸ“Š ë¦¬í¬íŠ¸ íƒ€ì…: $REPORT_TYPE"
        echo "ğŸ“… ë°ì´í„° ê¸°ê°„: $DATA_PERIOD_START ~ $DATA_PERIOD_END"
        echo "â° ì´ì „ ì‘ì—… ìƒíƒœ:"
        echo "  - PokerNews: ${{ needs.pokernews-analysis.outputs.status || 'skipped' }}"
        echo "  - YouTube: ${{ needs.youtube-analysis.outputs.status || 'skipped' }}"
        echo "ğŸ“‚ V5 ì‘ì—… ë””ë ‰í† ë¦¬: $WORKING_PATH"  
        echo "ğŸ“ V5 ìŠ¤í¬ë¦½íŠ¸ ë””ë ‰í† ë¦¬: $SCRIPTS_PATH"
        echo "ğŸ” í˜„ì¬ ìœ„ì¹˜: $(pwd)"
        echo ""
        
        # V5 í˜ì‹ : ë‹¨ê³„ë³„ ì•ˆì „ ì´ë™
        echo "ğŸ”§ V5 1ë‹¨ê³„: ì‘ì—… ë””ë ‰í† ë¦¬ ì´ë™"
        cd "$WORKING_PATH" || {
          echo "âŒ V5 ERROR: ì‘ì—… ë””ë ‰í† ë¦¬ ì´ë™ ì‹¤íŒ¨: $WORKING_PATH"
          echo "ğŸ” í˜„ì¬ ìœ„ì¹˜ í™•ì¸: $(pwd)"
          echo "ğŸ“‹ í˜„ì¬ ë””ë ‰í† ë¦¬ ë‚´ìš©:"
          ls -la
          exit 1
        }
        
        echo "âœ… V5 1ë‹¨ê³„ ì™„ë£Œ: ì‘ì—… ë””ë ‰í† ë¦¬ ì´ë™"
        echo "ğŸ“ í˜„ì¬ ìœ„ì¹˜: $(pwd)"
        echo "ğŸ“‹ ì‘ì—… ë””ë ‰í† ë¦¬ ë‚´ìš©:"
        ls -la
        echo ""
        
        # ë””ë²„ê·¸ ëª¨ë“œ ì •ë³´ ì¶œë ¥
        if [[ "${{ github.event.inputs.debug_mode }}" == "true" ]]; then
          echo "ğŸ” DEBUG: Platform V5 í™˜ê²½ í™•ì¸"
          echo "Python ë²„ì „: $(python --version)"
          echo "pip ë²„ì „: $(pip --version)"
          echo "ì‘ì—… ë””ë ‰í† ë¦¬: $(pwd)"
          echo "scripts ë””ë ‰í† ë¦¬ ë‚´ìš©:"
          ls -la scripts/
          echo "requirements.txt ìœ„ì¹˜ í™•ì¸:"
          find . -name "requirements.txt" -type f
        fi
        
        # V5 í˜ì‹ : ì˜ì¡´ì„± ì„¤ì¹˜ (requirements.txt ìœ„ì¹˜ ìë™ ê°ì§€)
        echo "ğŸ“¦ V5 2ë‹¨ê³„: ì˜ì¡´ì„± ì„¤ì¹˜"
        pip install --upgrade pip
        
        if [[ -f "requirements.txt" ]]; then
          echo "âœ… requirements.txt ë°œê²¬ (í˜„ì¬ ë””ë ‰í† ë¦¬)"
          pip install -r requirements.txt
        elif [[ -f "scripts/requirements.txt" ]]; then
          echo "âœ… requirements.txt ë°œê²¬ (scripts ë””ë ‰í† ë¦¬)"
          pip install -r scripts/requirements.txt
        else
          echo "âŒ requirements.txtë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!"
          find . -name "requirements.txt" -type f
          exit 1
        fi
        echo "âœ… V5 2ë‹¨ê³„ ì™„ë£Œ: ì˜ì¡´ì„± ì„¤ì¹˜"
        echo ""
        
        # 5ì´ˆ ëŒ€ê¸° (ì´ì „ Slack ë©”ì‹œì§€ë“¤ê³¼ì˜ ê°„ê²© í™•ë³´)
        sleep 5
        
        # V5 í˜ì‹ : ìŠ¤í¬ë¦½íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì•ˆì „ ì´ë™
        echo "ğŸ”§ V5 3ë‹¨ê³„: ìŠ¤í¬ë¦½íŠ¸ ë””ë ‰í† ë¦¬ ì´ë™"
        cd "$SCRIPTS_PATH" || {
          echo "âŒ V5 ERROR: ìŠ¤í¬ë¦½íŠ¸ ë””ë ‰í† ë¦¬ ì´ë™ ì‹¤íŒ¨: $SCRIPTS_PATH"
          echo "ğŸ” í˜„ì¬ ìœ„ì¹˜: $(pwd)"
          exit 1
        }
        
        echo "âœ… V5 3ë‹¨ê³„ ì™„ë£Œ: ìŠ¤í¬ë¦½íŠ¸ ë””ë ‰í† ë¦¬ ì´ë™"
        echo "ğŸ“ í˜„ì¬ ìœ„ì¹˜: $(pwd)"
        echo "ğŸ“‹ ìŠ¤í¬ë¦½íŠ¸ ë””ë ‰í† ë¦¬ ë‚´ìš©:"
        ls -la *.py
        echo ""
        
        # V5 í˜ì‹ : ë‹¨ê³„ë³„ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
        echo "ğŸ¯ V5 4ë‹¨ê³„: Platform ë¶„ì„ ì‹¤í–‰"
        
        # Firebase REST API ë°ì´í„° ìˆ˜ì§‘
        echo "ğŸ”¥ Firebase ë°ì´í„° ìˆ˜ì§‘ ì¤‘..."
        if python firebase_rest_api_fetcher.py > ../platform_output.log 2>&1; then
          echo "âœ… Firebase ë°ì´í„° ìˆ˜ì§‘ ì„±ê³µ"
        else
          echo "âš ï¸ Firebase ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨ (ê³„ì† ì§„í–‰)"
          cat ../platform_output.log || echo "ë¡œê·¸ ì—†ìŒ"
        fi
        
        # ì¼ì¼ ë¹„êµ ë¶„ì„  
        echo "ğŸ“Š ì¼ì¼ ë¹„êµ ë¶„ì„ ì¤‘..."
        if python show_daily_comparison.py >> ../platform_output.log 2>&1; then
          echo "âœ… ì¼ì¼ ë¹„êµ ë¶„ì„ ì„±ê³µ"
        else
          echo "âš ï¸ ì¼ì¼ ë¹„êµ ë¶„ì„ ì‹¤íŒ¨ (ê³„ì† ì§„í–‰)"
          cat ../platform_output.log || echo "ë¡œê·¸ ì—†ìŒ"
        fi
        
        # Slack ë¦¬í¬íŠ¸ ì „ì†¡
        echo "ğŸ“¤ Slack ë¦¬í¬íŠ¸ ì „ì†¡ ì¤‘..."
        if python final_slack_reporter.py >> ../platform_output.log 2>&1; then
          echo "âœ… Platform ë¶„ì„ V5 ì™„ë£Œ ğŸ‰"
          echo "ğŸ”§ V5 í˜ì‹ : ê²½ë¡œ ì¤‘ë³µ ë¬¸ì œ ì™„ì „ ê·¼ì ˆ!"
          echo "status=success" >> $GITHUB_OUTPUT
          echo "slack_sent=true" >> $GITHUB_OUTPUT
          
          echo ""
          echo "ğŸ“‹ Platform ë¶„ì„ ê²°ê³¼:"
          cat ../platform_output.log || echo "ë¡œê·¸ íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
        else
          echo "âŒ Platform ë¶„ì„ ì‹¤íŒ¨"
          echo "status=failed" >> $GITHUB_OUTPUT
          echo "slack_sent=false" >> $GITHUB_OUTPUT
          
          echo "ğŸ“‹ Platform ì—ëŸ¬ ë¡œê·¸:"
          cat ../platform_output.log || echo "ë¡œê·¸ íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
          
          error_msg=$(cat ../platform_output.log 2>/dev/null | tail -5 || echo "Unknown error")
          echo "error_message=$error_msg" >> $GITHUB_OUTPUT
          
          exit 1
        fi
    
    - name: ğŸ“„ Upload Platform Reports
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: platform-reports-v5-${{ needs.schedule-determination.outputs.report_type }}-${{ github.run_id }}
        path: |
          ${{ steps.smart-path-detection.outputs.working_path }}/*.json
          ${{ steps.smart-path-detection.outputs.scripts_path }}/*.json
        if-no-files-found: ignore
        retention-days: 30

  # Job 5: ìµœì¢… ë³´ê³  ë° ì •ë¦¬ (V5 ì™„ì „ ê°œì„ )
  final-report:
    name: "ğŸ“Š ìµœì¢… ë³´ê³  (V5 ì™„ì „ ê°œì„ )"
    runs-on: ubuntu-latest
    needs: [schedule-determination, pokernews-analysis, youtube-analysis, platform-analysis]
    if: always() && needs.schedule-determination.outputs.report_type != 'none'
    timeout-minutes: 5

    steps:
    - name: ğŸ“Š V5 ê²°ê³¼ ìˆ˜ì§‘ ë° ìš”ì•½
      id: summary
      run: |
        echo "ğŸ“Š í†µí•© í¬ì»¤ ë³´ê³  ì‹œìŠ¤í…œ V5 ì‹¤í–‰ ê²°ê³¼"
        echo "============================================"
        echo "ğŸ“… ë¦¬í¬íŠ¸ íƒ€ì…: ${{ needs.schedule-determination.outputs.report_type }}"
        echo "ğŸ“ˆ ë°ì´í„° ê¸°ê°„: ${{ needs.schedule-determination.outputs.data_period_start }} ~ ${{ needs.schedule-determination.outputs.data_period_end }}"
        echo "ğŸ·ï¸ ì›Œí¬í”Œë¡œìš° ë²„ì „: ${{ env.WORKFLOW_VERSION }}"
        echo "ğŸ”§ V5 í•µì‹¬ ê°œì„ : Smart Path Detection ì ìš©"
        echo ""
        echo "ğŸ”„ ì‹¤í–‰ ê²°ê³¼:"
        echo "  ğŸ“° PokerNews: ${{ needs.pokernews-analysis.outputs.status || 'skipped' }}"
        echo "  ğŸ¥ YouTube: ${{ needs.youtube-analysis.outputs.status || 'skipped' }}"
        echo "  ğŸ“Š Platform: ${{ needs.platform-analysis.outputs.status || 'skipped' }}"
        echo ""
        echo "ğŸ“‚ V5 íƒì§€ëœ ê²½ë¡œ:"
        echo "  ğŸ“° PokerNews: ${{ needs.pokernews-analysis.outputs.working_path || 'N/A' }}"
        echo "  ğŸ¥ YouTube: ${{ needs.youtube-analysis.outputs.working_path || 'N/A' }}"
        echo "  ğŸ“Š Platform: ${{ needs.platform-analysis.outputs.working_path || 'N/A' }}"
        echo "  ğŸ“ Scripts: ${{ needs.platform-analysis.outputs.scripts_path || 'N/A' }}"
        echo "============================================"
        
        # ì„±ê³µë¥  ê³„ì‚°
        SUCCESS_COUNT=0
        TOTAL_COUNT=0
        
        if [[ "${{ needs.schedule-determination.outputs.should_run_pokernews }}" == "true" ]]; then
          TOTAL_COUNT=$((TOTAL_COUNT + 1))
          [[ "${{ needs.pokernews-analysis.outputs.status }}" == "success" ]] && SUCCESS_COUNT=$((SUCCESS_COUNT + 1))
        fi
        
        if [[ "${{ needs.schedule-determination.outputs.should_run_youtube }}" == "true" ]]; then
          TOTAL_COUNT=$((TOTAL_COUNT + 1))
          [[ "${{ needs.youtube-analysis.outputs.status }}" == "success" ]] && SUCCESS_COUNT=$((SUCCESS_COUNT + 1))
        fi
        
        if [[ "${{ needs.schedule-determination.outputs.should_run_platform }}" == "true" ]]; then
          TOTAL_COUNT=$((TOTAL_COUNT + 1))
          [[ "${{ needs.platform-analysis.outputs.status }}" == "success" ]] && SUCCESS_COUNT=$((SUCCESS_COUNT + 1))
        fi
        
        if [[ $TOTAL_COUNT -gt 0 ]]; then
          SUCCESS_RATE=$((SUCCESS_COUNT * 100 / TOTAL_COUNT))
          echo "ğŸ“ˆ ì„±ê³µë¥ : $SUCCESS_RATE% ($SUCCESS_COUNT/$TOTAL_COUNT)"
          echo "success_rate=$SUCCESS_RATE" >> $GITHUB_OUTPUT
        else
          echo "success_rate=0" >> $GITHUB_OUTPUT
        fi
        
        # ì „ì²´ ìƒíƒœ ê²°ì •
        if [[ $SUCCESS_COUNT -eq $TOTAL_COUNT ]] && [[ $TOTAL_COUNT -gt 0 ]]; then
          OVERALL_STATUS="âœ… ì™„ì „ ì„±ê³µ"
          echo "overall_status=success" >> $GITHUB_OUTPUT
        elif [[ $SUCCESS_COUNT -gt 0 ]]; then
          OVERALL_STATUS="âš ï¸ ë¶€ë¶„ ì„±ê³µ"
          echo "overall_status=partial_success" >> $GITHUB_OUTPUT
        else
          OVERALL_STATUS="âŒ ì „ì²´ ì‹¤íŒ¨"
          echo "overall_status=failure" >> $GITHUB_OUTPUT
        fi
        
        echo "ğŸ“Š ì „ì²´ ìƒíƒœ: $OVERALL_STATUS"

    - name: ğŸ“¤ Slack ìµœì¢… ë³´ê³  (V5 ì™„ì „ ê°œì„ )
      if: always()
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
      run: |
        if [[ -n "$SLACK_WEBHOOK_URL" ]]; then
          REPORT_TYPE="${{ needs.schedule-determination.outputs.report_type }}"
          DATA_START="${{ needs.schedule-determination.outputs.data_period_start }}"
          DATA_END="${{ needs.schedule-determination.outputs.data_period_end }}"
          OVERALL_STATUS="${{ steps.summary.outputs.overall_status }}"
          SUCCESS_RATE="${{ steps.summary.outputs.success_rate }}"
          COMPLETION_TIME="$(TZ=Asia/Seoul date '+%Y-%m-%d %H:%M:%S %Z')"
          
          # V5 ê²½ë¡œ ì •ë³´ ìˆ˜ì§‘
          POKERNEWS_PATH="${{ needs.pokernews-analysis.outputs.working_path || 'N/A' }}"
          YOUTUBE_PATH="${{ needs.youtube-analysis.outputs.working_path || 'N/A' }}"
          PLATFORM_PATH="${{ needs.platform-analysis.outputs.working_path || 'N/A' }}"
          
          # ìƒíƒœë³„ ì´ëª¨ì§€ ì„¤ì •
          case $OVERALL_STATUS in
            "success")
              STATUS_EMOJI="âœ…"
              STATUS_TEXT="ëª¨ë“  ë¶„ì„ ì™„ë£Œ"
              STATUS_COLOR="good"
              ;;
            "partial_success")
              STATUS_EMOJI="âš ï¸"
              STATUS_TEXT="ì¼ë¶€ ë¶„ì„ ì„±ê³µ"
              STATUS_COLOR="warning"
              ;;
            *)
              STATUS_EMOJI="âŒ"
              STATUS_TEXT="ë¶„ì„ ì‹¤íŒ¨"
              STATUS_COLOR="danger"
              ;;
          esac
          
          # ê°œë³„ ìƒíƒœ í™•ì¸
          POKERNEWS_STATUS="${{ needs.pokernews-analysis.outputs.status || 'skipped' }}"
          YOUTUBE_STATUS="${{ needs.youtube-analysis.outputs.status || 'skipped' }}"
          PLATFORM_STATUS="${{ needs.platform-analysis.outputs.status || 'skipped' }}"
          
          # ìƒíƒœë³„ ì´ëª¨ì§€ ì¶”ê°€
          [[ "$POKERNEWS_STATUS" == "success" ]] && POKERNEWS_EMOJI="âœ…" || POKERNEWS_EMOJI="âŒ"
          [[ "$YOUTUBE_STATUS" == "success" ]] && YOUTUBE_EMOJI="âœ…" || YOUTUBE_EMOJI="âŒ"
          [[ "$PLATFORM_STATUS" == "success" ]] && PLATFORM_EMOJI="âœ…" || PLATFORM_EMOJI="âŒ"
          
          [[ "$POKERNEWS_STATUS" == "skipped" ]] && POKERNEWS_EMOJI="â©"
          [[ "$YOUTUBE_STATUS" == "skipped" ]] && YOUTUBE_EMOJI="â©"
          [[ "$PLATFORM_STATUS" == "skipped" ]] && PLATFORM_EMOJI="â©"
          
          curl -X POST -H 'Content-type: application/json' \
               --data "{
                 \"blocks\": [
                   {
                     \"type\": \"header\",
                     \"text\": {
                       \"type\": \"plain_text\",
                       \"text\": \"${STATUS_EMOJI} í†µí•© í¬ì»¤ ë³´ê³  ì‹œìŠ¤í…œ ì™„ë£Œ (V5)\",
                       \"emoji\": true
                     }
                   },
                   {
                     \"type\": \"section\",
                     \"text\": {
                       \"type\": \"mrkdwn\",
                       \"text\": \"*ğŸ“… ì™„ë£Œ ì‹œê°„:* ${COMPLETION_TIME}\\n*ğŸ“Š ë¦¬í¬íŠ¸ íƒ€ì…:* ${REPORT_TYPE}\\n*ğŸ“ˆ ë°ì´í„° ê¸°ê°„:* ${DATA_START} ~ ${DATA_END}\\n*ğŸ¯ ì „ì²´ ìƒíƒœ:* ${STATUS_TEXT}\\n*ğŸ“Š ì„±ê³µë¥ :* ${SUCCESS_RATE}%\\n*ğŸ·ï¸ ë²„ì „:* ${{ env.WORKFLOW_VERSION }}\\n*ğŸ”§ V5 í˜ì‹ :* Smart Path Detection ì ìš©\"
                     }
                   },
                   {
                     \"type\": \"section\",
                     \"text\": {
                       \"type\": \"mrkdwn\",
                       \"text\": \"*ğŸ“‹ ê°œë³„ ë¶„ì„ ê²°ê³¼:*\\n${POKERNEWS_EMOJI} PokerNews: ${POKERNEWS_STATUS}\\n${YOUTUBE_EMOJI} YouTube: ${YOUTUBE_STATUS}\\n${PLATFORM_EMOJI} Platform: ${PLATFORM_STATUS}\"
                     }
                   },
                   {
                     \"type\": \"section\",
                     \"text\": {
                       \"type\": \"mrkdwn\",
                       \"text\": \"*ğŸ“‚ V5 íƒì§€ëœ ê²½ë¡œ:*\\nâ€¢ PokerNews: \`${POKERNEWS_PATH}\`\\nâ€¢ YouTube: \`${YOUTUBE_PATH}\`\\nâ€¢ Platform: \`${PLATFORM_PATH}\`\"
                     }
                   },
                   {
                     \"type\": \"section\",
                     \"text\": {
                       \"type\": \"mrkdwn\",
                       \"text\": \"*ğŸ”— ìƒì„¸ ê²°ê³¼:* <https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}|GitHub Actions ë¡œê·¸ í™•ì¸>\\n*ğŸ‰ V5 ì„±ê³¼:* ê²½ë¡œ ì¤‘ë³µ ë¬¸ì œ ì™„ì „ ê·¼ì ˆ!\"
                     }
                   }
                 ]
               }" \
               "$SLACK_WEBHOOK_URL"
        fi