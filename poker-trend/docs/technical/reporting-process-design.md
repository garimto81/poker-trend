# 🏗️ 포커 트렌드 보고 프로세스 설계

## 📐 전체 아키텍처

```
┌─────────────────────────────────────────────────────────────────────┐
│                        보고 프로세스 플로우                           │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  [1단계: 키워드 수집]                                                │
│  매일 02:00 KST                                                     │
│  └─> 동적 키워드 업데이트                                           │
│      └─> dynamic_keyword_collector.py                              │
│          └─> data/dynamic_keywords.json 저장                       │
│                                                                     │
│  [2단계: 리포트 타입 결정]                                           │
│  평일 10:00 KST                                                     │
│  └─> unified-reporting.yml 실행                                    │
│      └─> 날짜 확인 로직                                            │
│          ├─> 첫째주 월요일? → 월간 리포트                           │
│          ├─> 기타 월요일? → 주간 리포트                             │
│          └─> 화~금요일? → 일간 리포트                               │
│                                                                     │
│  [3단계: 데이터 수집 및 분석]                                        │
│  └─> 해당 스크립트 실행                                             │
│      ├─> YouTube API 호출                                          │
│      ├─> 트렌드 분석                                               │
│      └─> AI 인사이트 생성                                          │
│                                                                     │
│  [4단계: 리포트 전송]                                               │
│  └─> Slack Webhook 전송                                            │
│      └─> 데이터 아카이빙                                           │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

## 🔄 단계별 상세 프로세스

### 1️⃣ 키워드 수집 단계 (매일 02:00)

```python
# dynamic_keyword_collector.py 주요 프로세스

1. YouTube 트렌딩 수집
   └─> 게임 카테고리 인기 영상 50개
   └─> 포커 관련 영상 필터링
   └─> 제목/태그에서 키워드 추출

2. 관련 검색어 수집
   └─> 기본 키워드로 검색
   └─> 검색 결과에서 빈출 단어 추출

3. 인기 영상 태그 분석
   └─> 최근 24시간 인기 영상
   └─> 태그 수집 및 빈도 분석

4. 댓글 키워드 추출
   └─> 인기 영상 댓글 분석
   └─> 자주 언급되는 용어 수집

5. 키워드 순위 결정
   └─> 빈도수 기반 가중치 계산
   └─> 상위 20개 트렌딩 키워드 선정
   └─> JSON 파일로 저장
```

### 2️⃣ 리포트 타입 결정 (평일 10:00)

```yaml
# unified-reporting.yml 결정 로직

determine-report-type:
  steps:
    - name: 날짜 확인
      run: |
        # 한국 시간 기준 날짜 계산
        DAY_OF_WEEK=$(TZ=Asia/Seoul date +%u)  # 1=월요일
        DAY_OF_MONTH=$(TZ=Asia/Seoul date +%d)
        
        # 리포트 타입 결정 알고리즘
        if [ 월요일 ] && [ 날짜 <= 7 ]; then
          report_type="monthly"  # 첫째주 월요일
        elif [ 월요일 ]; then
          report_type="weekly"   # 나머지 월요일
        else
          report_type="daily"    # 화~금요일
        fi
```

### 3️⃣ 데이터 수집 및 분석

#### 일간 리포트 (youtube_trend_webhook_enhanced.py)
```python
프로세스:
1. 키워드 로드
   - 기본 키워드 (5개) + 동적 키워드 (20개)
   
2. YouTube 데이터 수집 (48시간)
   - 키워드별 검색 (viewCount, relevance, date 정렬)
   - 영상당 상세 정보 수집
   - 최대 100개 영상 분석
   
3. 트렌드 분석
   - 트렌드 스코어 계산
   - 카테고리 자동 분류
   - 시간당 조회수 계산
   - 참여율 분석
   
4. AI 쇼츠 제안 생성
   - Gemini API 호출
   - 트렌드 데이터 기반 5개 아이디어
```

#### 주간 리포트 (weekly_trend_report.py)
```python
프로세스:
1. 7일간 일별 데이터 수집
   - 각 날짜별 영상 수집
   - 일별 트렌드 변화 추적
   
2. 주간 통합 분석
   - TOP 키워드 변화
   - 새로운 트렌드 감지
   - 카테고리별 성과
   - 최적 업로드 시간
   
3. 이전 주 대비 분석
   - 신규 키워드 발견
   - 성장/하락 트렌드
```

#### 월간 리포트 (monthly_trend_report.py)
```python
프로세스:
1. 30일간 주차별 데이터 수집
   - 4주간 데이터 분할 수집
   - 주차별 트렌드 변화
   
2. 월간 종합 분석
   - 바이럴 영상 선정 (상위 1%)
   - 채널 순위 분석
   - 카테고리별 심층 분석
   
3. 장기 트렌드 도출
   - 월간 패턴 분석
   - 성장 동력 파악
```

### 4️⃣ 리포트 전송 및 저장

```python
# Slack 메시지 구조

blocks = [
    # 헤더 (리포트 종류별 다름)
    {
        "type": "header",
        "text": {"type": "plain_text", "text": "리포트 제목"}
    },
    
    # 요약 섹션
    {
        "type": "section",
        "text": {"type": "mrkdwn", "text": "핵심 통계"}
    },
    
    # 데이터 시각화
    {
        "type": "section",
        "fields": [...]  # 카테고리, 키워드 등
    },
    
    # AI 인사이트
    {
        "type": "section",
        "text": {"type": "mrkdwn", "text": "AI 분석 결과"}
    }
]

# 데이터 저장
reports/
├── daily_report_20240115.json
├── weekly_report_202403.json    # 2024년 3주차
└── monthly_report_202401.json   # 2024년 1월
```

## 🎯 핵심 설계 원칙

### 1. 모듈화
- 각 리포트 타입별 독립 스크립트
- 공통 기능은 재사용 가능하도록 구성
- 키워드 수집과 리포팅 분리

### 2. 자동화
- GitHub Actions 스케줄링
- 날짜 기반 자동 리포트 선택
- 에러 발생시 자동 알림

### 3. 확장성
- 새로운 데이터 소스 추가 용이
- 리포트 형식 커스터마이징 가능
- 다국어 지원 가능 구조

### 4. 성능 최적화
- API 호출 최소화 (배치 처리)
- 캐싱 활용
- 병렬 처리 가능 구조

## 📊 데이터 플로우

```
YouTube API → 원시 데이터 수집
    ↓
트렌드 분석 엔진 → 메트릭스 계산
    ↓
AI 인사이트 생성 → Gemini API
    ↓
리포트 포맷팅 → Slack 블록 구성
    ↓
전송 및 아카이빙 → Slack + JSON 저장
```

## 🔧 환경 변수 관리

```yaml
GitHub Secrets:
  YOUTUBE_API_KEY:     # 데이터 수집
  SLACK_WEBHOOK_URL:   # 리포트 전송
  GEMINI_API_KEY:      # AI 분석
  
사용 위치:
  - GitHub Actions 워크플로우
  - Python 스크립트 (os.getenv)
```

## 📈 모니터링 및 로깅

1. **실행 로그**
   - GitHub Actions 로그
   - Python logging 모듈
   - 에러 발생시 Slack 알림

2. **성과 추적**
   - 리포트 생성 성공률
   - API 사용량 모니터링
   - 응답 시간 측정

3. **데이터 품질**
   - 수집 영상 수 검증
   - 키워드 다양성 확인
   - 중복 제거 로직

## 🚨 에러 처리

```python
# 단계별 에러 처리
try:
    # API 호출
except HttpError:
    # API 할당량 초과 처리
except Exception:
    # 일반 에러 → Slack 알림
    
# 부분 실패 허용
- 일부 키워드 실패시 계속 진행
- 최소 데이터로도 리포트 생성
- 실패 내역 로깅
```

이러한 설계를 통해 안정적이고 확장 가능한 포커 트렌드 보고 시스템을 구축했습니다.