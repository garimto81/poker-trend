<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²½ëŸ‰ UI ê°ì§€ ì‹œìŠ¤í…œ (í•™ìŠµ ì—†ìŒ)</title>
    <style>
        body {
            font-family: -apple-system, sans-serif;
            background: #1a1a2e;
            color: #eee;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .video-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .video-box {
            background: #16213e;
            padding: 20px;
            border-radius: 10px;
        }
        video, canvas {
            width: 100%;
            border-radius: 8px;
        }
        .controls {
            background: #0f3460;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2980b9;
        }
        .metric {
            background: #0f3460;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .metric-bar {
            width: 200px;
            height: 20px;
            background: #1a1a2e;
            border-radius: 10px;
            overflow: hidden;
        }
        .metric-fill {
            height: 100%;
            background: linear-gradient(to right, #3498db, #2ecc71);
            transition: width 0.3s;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            margin: 10px 0;
        }
        .ui-detected {
            background: #e74c3c;
            color: white;
        }
        .game-active {
            background: #2ecc71;
            color: white;
        }
        .template-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        .template-item {
            background: #0f3460;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .template-item:hover {
            transform: scale(1.05);
            background: #1a4a7a;
        }
        .template-item img {
            width: 100%;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ ê²½ëŸ‰ UI ê°ì§€ ì‹œìŠ¤í…œ</h1>
        <p>ë¨¸ì‹ ëŸ¬ë‹ ì—†ì´ íœ´ë¦¬ìŠ¤í‹±ê³¼ íŒ¨í„´ ë§¤ì¹­ìœ¼ë¡œ UIë¥¼ ê°ì§€í•©ë‹ˆë‹¤</p>
        
        <div class="video-section">
            <div class="video-box">
                <h3>ğŸ“¹ ì›ë³¸ ì˜ìƒ</h3>
                <video id="videoInput" controls></video>
                <input type="file" id="fileInput" accept="video/*">
            </div>
            <div class="video-box">
                <h3>ğŸ” ë¶„ì„ ê²°ê³¼</h3>
                <canvas id="analysisCanvas"></canvas>
                <div id="detectionStatus" class="status game-active">ê²Œì„ ì§„í–‰ ì¤‘</div>
            </div>
        </div>
        
        <div class="controls">
            <h3>âš™ï¸ ê°ì§€ ì„¤ì •</h3>
            <button onclick="startAnalysis()">â–¶ï¸ ë¶„ì„ ì‹œì‘</button>
            <button onclick="pauseAnalysis()">â¸ï¸ ì¼ì‹œì •ì§€</button>
            <button onclick="markAsUI()">ğŸ¨ í˜„ì¬ í”„ë ˆì„ì„ UIë¡œ í‘œì‹œ</button>
            <button onclick="clearTemplates()">ğŸ—‘ï¸ í…œí”Œë¦¿ ì´ˆê¸°í™”</button>
        </div>
        
        <div class="metrics">
            <h3>ğŸ“Š ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­</h3>
            
            <div class="metric">
                <span>ì •ì  í”½ì…€ ë¹„ìœ¨</span>
                <div class="metric-bar">
                    <div class="metric-fill" id="staticRatio" style="width: 20%"></div>
                </div>
                <span id="staticValue">20%</span>
            </div>
            
            <div class="metric">
                <span>ì—£ì§€ ë°€ë„</span>
                <div class="metric-bar">
                    <div class="metric-fill" id="edgeRatio" style="width: 15%"></div>
                </div>
                <span id="edgeValue">15%</span>
            </div>
            
            <div class="metric">
                <span>ìƒ‰ìƒ ê· ì¼ë„</span>
                <div class="metric-bar">
                    <div class="metric-fill" id="colorRatio" style="width: 30%"></div>
                </div>
                <span id="colorValue">30%</span>
            </div>
            
            <div class="metric">
                <span>ë¸”ë¡ êµ¬ì¡°</span>
                <div class="metric-bar">
                    <div class="metric-fill" id="blockRatio" style="width: 25%"></div>
                </div>
                <span id="blockValue">25%</span>
            </div>
            
            <div class="metric">
                <span><strong>ì¢…í•© UI ì ìˆ˜</strong></span>
                <div class="metric-bar">
                    <div class="metric-fill" id="uiScore" style="width: 22%; background: linear-gradient(to right, #e74c3c, #f39c12)"></div>
                </div>
                <span id="uiScoreValue" style="font-weight: bold; color: #f39c12;">22%</span>
            </div>
        </div>
        
        <div class="template-section">
            <h3>ğŸ“¸ UI í…œí”Œë¦¿ ê°¤ëŸ¬ë¦¬</h3>
            <p>ì‚¬ìš©ìê°€ í‘œì‹œí•œ UI íŒ¨í„´ë“¤ (í´ë¦­í•˜ì—¬ ì‚­ì œ)</p>
            <div class="template-gallery" id="templateGallery">
                <!-- í…œí”Œë¦¿ë“¤ì´ ì—¬ê¸° í‘œì‹œë¨ -->
            </div>
        </div>
    </div>
    
    <script>
        let video = document.getElementById('videoInput');
        let canvas = document.getElementById('analysisCanvas');
        let ctx = canvas.getContext('2d');
        let isAnalyzing = false;
        let previousFrame = null;
        let uiTemplates = [];
        let frameBuffer = [];
        let uiDuration = 0;
        
        // íŒŒì¼ ì…ë ¥ ì²˜ë¦¬
        document.getElementById('fileInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                video.src = URL.createObjectURL(file);
                video.onloadedmetadata = () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                };
            }
        });
        
        // ë¶„ì„ ì‹œì‘
        function startAnalysis() {
            isAnalyzing = true;
            analyzeFrame();
        }
        
        // ë¶„ì„ ì¼ì‹œì •ì§€
        function pauseAnalysis() {
            isAnalyzing = false;
        }
        
        // í”„ë ˆì„ ë¶„ì„
        function analyzeFrame() {
            if (!isAnalyzing || video.paused || video.ended) return;
            
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            // íœ´ë¦¬ìŠ¤í‹± ê¸°ë°˜ ë¶„ì„
            const metrics = analyzeHeuristics(imageData);
            updateMetrics(metrics);
            
            // UI ê°ì§€ íŒì •
            const isUI = detectUI(metrics);
            updateStatus(isUI);
            
            // ë‹¤ìŒ í”„ë ˆì„
            requestAnimationFrame(analyzeFrame);
        }
        
        // íœ´ë¦¬ìŠ¤í‹± ë¶„ì„
        function analyzeHeuristics(imageData) {
            const data = imageData.data;
            const width = imageData.width;
            const height = imageData.height;
            
            // 1. ì •ì  í”½ì…€ ë¹„ìœ¨ (ì´ì „ í”„ë ˆì„ê³¼ ë¹„êµ)
            let staticPixels = 0;
            if (previousFrame) {
                for (let i = 0; i < data.length; i += 4) {
                    const diff = Math.abs(data[i] - previousFrame[i]) +
                                Math.abs(data[i+1] - previousFrame[i+1]) +
                                Math.abs(data[i+2] - previousFrame[i+2]);
                    if (diff < 30) staticPixels++;
                }
            }
            const staticRatio = previousFrame ? (staticPixels / (width * height)) * 100 : 50;
            
            // 2. ì—£ì§€ ë°€ë„ (ê°„ë‹¨í•œ ì—£ì§€ ê°ì§€)
            let edges = 0;
            for (let y = 1; y < height - 1; y++) {
                for (let x = 1; x < width - 1; x++) {
                    const idx = (y * width + x) * 4;
                    const gx = Math.abs(data[idx] - data[idx + 4]);
                    const gy = Math.abs(data[idx] - data[idx + width * 4]);
                    if (gx + gy > 50) edges++;
                }
            }
            const edgeRatio = (edges / (width * height)) * 100;
            
            // 3. ìƒ‰ìƒ ê· ì¼ë„ (ìƒ‰ìƒ ë¶„í¬)
            const colorBins = new Array(8).fill(0);
            for (let i = 0; i < data.length; i += 4) {
                const brightness = (data[i] + data[i+1] + data[i+2]) / 3;
                const bin = Math.floor(brightness / 32);
                colorBins[bin]++;
            }
            const maxBin = Math.max(...colorBins);
            const colorUniformity = (maxBin / (width * height / 4)) * 100;
            
            // 4. ë¸”ë¡ êµ¬ì¡° ê°ì§€ (ê·¸ë¦¬ë“œ íŒ¨í„´)
            let blockScore = detectBlockStructure(imageData);
            
            // í”„ë ˆì„ ì €ì¥
            previousFrame = new Uint8ClampedArray(data);
            
            return {
                static: staticRatio,
                edges: edgeRatio,
                color: colorUniformity,
                blocks: blockScore
            };
        }
        
        // ë¸”ë¡ êµ¬ì¡° ê°ì§€
        function detectBlockStructure(imageData) {
            // ê°„ë‹¨í•œ ê·¸ë¦¬ë“œ íŒ¨í„´ ê°ì§€
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ë” ì •êµí•œ ì•Œê³ ë¦¬ì¦˜ ì‚¬ìš©
            return Math.random() * 40 + 20; // ì‹œë®¬ë ˆì´ì…˜
        }
        
        // UI ê°ì§€ ë¡œì§
        function detectUI(metrics) {
            // ê·œì¹™ ê¸°ë°˜ íŒì •
            const uiScore = (
                metrics.static * 0.3 +
                metrics.edges * 0.2 +
                metrics.color * 0.3 +
                metrics.blocks * 0.2
            );
            
            // í…œí”Œë¦¿ ë§¤ì¹­ ì ìˆ˜ ì¶”ê°€
            const templateScore = matchTemplates();
            const finalScore = uiScore * 0.7 + templateScore * 0.3;
            
            document.getElementById('uiScore').style.width = finalScore + '%';
            document.getElementById('uiScoreValue').textContent = Math.floor(finalScore) + '%';
            
            // UI íŒì • (65% ì´ìƒ)
            return finalScore > 65;
        }
        
        // í…œí”Œë¦¿ ë§¤ì¹­
        function matchTemplates() {
            if (uiTemplates.length === 0) return 0;
            
            // í˜„ì¬ í”„ë ˆì„ê³¼ í…œí”Œë¦¿ ë¹„êµ
            // ê°„ë‹¨í•œ íˆìŠ¤í† ê·¸ë¨ ë¹„êµ êµ¬í˜„
            return Math.random() * 30 + 40; // ì‹œë®¬ë ˆì´ì…˜
        }
        
        // ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
        function updateMetrics(metrics) {
            document.getElementById('staticRatio').style.width = metrics.static + '%';
            document.getElementById('staticValue').textContent = Math.floor(metrics.static) + '%';
            
            document.getElementById('edgeRatio').style.width = metrics.edges + '%';
            document.getElementById('edgeValue').textContent = Math.floor(metrics.edges) + '%';
            
            document.getElementById('colorRatio').style.width = metrics.color + '%';
            document.getElementById('colorValue').textContent = Math.floor(metrics.color) + '%';
            
            document.getElementById('blockRatio').style.width = metrics.blocks + '%';
            document.getElementById('blockValue').textContent = Math.floor(metrics.blocks) + '%';
        }
        
        // ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus(isUI) {
            const status = document.getElementById('detectionStatus');
            if (isUI) {
                uiDuration++;
                if (uiDuration > 450) { // 15ì´ˆ @ 30fps
                    status.className = 'status ui-detected';
                    status.textContent = 'ğŸ¨ UI ê°ì§€ë¨ (15ì´ˆ ì´ìƒ)';
                }
            } else {
                uiDuration = 0;
                status.className = 'status game-active';
                status.textContent = 'ğŸ® ê²Œì„ ì§„í–‰ ì¤‘';
            }
        }
        
        // í˜„ì¬ í”„ë ˆì„ì„ UIë¡œ í‘œì‹œ
        function markAsUI() {
            if (!video.paused) {
                pauseAnalysis();
            }
            
            // í˜„ì¬ í”„ë ˆì„ì„ í…œí”Œë¦¿ìœ¼ë¡œ ì €ì¥
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = 150;
            tempCanvas.height = 100;
            const tempCtx = tempCanvas.getContext('2d');
            tempCtx.drawImage(canvas, 0, 0, 150, 100);
            
            const template = {
                id: Date.now(),
                image: tempCanvas.toDataURL(),
                histogram: calculateHistogram(ctx.getImageData(0, 0, canvas.width, canvas.height))
            };
            
            uiTemplates.push(template);
            updateTemplateGallery();
        }
        
        // íˆìŠ¤í† ê·¸ë¨ ê³„ì‚°
        function calculateHistogram(imageData) {
            const histogram = new Array(256).fill(0);
            const data = imageData.data;
            
            for (let i = 0; i < data.length; i += 4) {
                const gray = Math.floor((data[i] + data[i+1] + data[i+2]) / 3);
                histogram[gray]++;
            }
            
            return histogram;
        }
        
        // í…œí”Œë¦¿ ê°¤ëŸ¬ë¦¬ ì—…ë°ì´íŠ¸
        function updateTemplateGallery() {
            const gallery = document.getElementById('templateGallery');
            gallery.innerHTML = uiTemplates.map(template => `
                <div class="template-item" onclick="removeTemplate(${template.id})">
                    <img src="${template.image}" alt="UI Template">
                    <small>í´ë¦­í•˜ì—¬ ì‚­ì œ</small>
                </div>
            `).join('');
        }
        
        // í…œí”Œë¦¿ ì‚­ì œ
        function removeTemplate(id) {
            uiTemplates = uiTemplates.filter(t => t.id !== id);
            updateTemplateGallery();
        }
        
        // í…œí”Œë¦¿ ì´ˆê¸°í™”
        function clearTemplates() {
            uiTemplates = [];
            updateTemplateGallery();
        }
    </script>
</body>
</html>