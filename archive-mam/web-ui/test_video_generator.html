<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í…ŒìŠ¤íŠ¸ ë¹„ë””ì˜¤ ìƒì„±ê¸°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        canvas {
            border: 1px solid #ccc;
            background-color: #000;
        }
        .controls {
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        .success {
            background-color: #4CAF50;
            color: white;
            border: none;
        }
        .primary {
            background-color: #2196F3;
            color: white;
            border: none;
        }
    </style>
</head>
<body>
    <h1>ğŸ¬ í…ŒìŠ¤íŠ¸ ë¹„ë””ì˜¤ ìƒì„±ê¸°</h1>
    <p>GFX ì˜¤ë²„ë ˆì´ í•™ìŠµê¸° í…ŒìŠ¤íŠ¸ìš© ë¹„ë””ì˜¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
    
    <canvas id="canvas" width="640" height="360"></canvas>
    
    <div class="controls">
        <button class="primary" onclick="generateTestVideo()">í…ŒìŠ¤íŠ¸ ë¹„ë””ì˜¤ ìƒì„±</button>
        <button class="success" onclick="downloadVideo()" id="downloadBtn" disabled>ë¹„ë””ì˜¤ ë‹¤ìš´ë¡œë“œ</button>
    </div>
    
    <div id="status">ì¤€ë¹„ë¨</div>
    
    <script>
        let mediaRecorder;
        let recordedChunks = [];
        let canvas = document.getElementById('canvas');
        let ctx = canvas.getContext('2d');
        
        function generateTestVideo() {
            document.getElementById('status').textContent = 'ë¹„ë””ì˜¤ ìƒì„± ì¤‘...';
            recordedChunks = [];
            
            // Canvasì—ì„œ ìŠ¤íŠ¸ë¦¼ ìƒì„±
            const stream = canvas.captureStream(30); // 30 FPS
            
            mediaRecorder = new MediaRecorder(stream, {
                mimeType: 'video/webm;codecs=vp9'
            });
            
            mediaRecorder.ondataavailable = function(event) {
                if (event.data.size > 0) {
                    recordedChunks.push(event.data);
                }
            };
            
            mediaRecorder.onstop = function() {
                const blob = new Blob(recordedChunks, { type: 'video/webm' });
                const url = URL.createObjectURL(blob);
                
                // ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í™œì„±í™”
                document.getElementById('downloadBtn').disabled = false;
                document.getElementById('downloadBtn').onclick = () => downloadBlob(blob, 'test_poker_video.webm');
                
                document.getElementById('status').textContent = 'ë¹„ë””ì˜¤ ìƒì„± ì™„ë£Œ! ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
            };
            
            // ë…¹í™” ì‹œì‘
            mediaRecorder.start();
            
            // 30ì´ˆ ë™ì•ˆ ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
            animatePokerGame();
            
            // 30ì´ˆ í›„ ë…¹í™” ì¤‘ì§€
            setTimeout(() => {
                mediaRecorder.stop();
            }, 30000);
        }
        
        function animatePokerGame() {
            let frame = 0;
            const totalFrames = 30 * 30; // 30ì´ˆ * 30fps
            
            function draw() {
                // ë°°ê²½ ê·¸ë¦¬ê¸° (í¬ì»¤ í…Œì´ë¸”)
                ctx.fillStyle = '#0d4d2d';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // í¬ì»¤ í…Œì´ë¸” íƒ€ì›
                ctx.beginPath();
                ctx.ellipse(canvas.width/2, canvas.height/2, 280, 150, 0, 0, 2 * Math.PI);
                ctx.fillStyle = '#1a5d3a';
                ctx.fill();
                ctx.strokeStyle = '#8B4513';
                ctx.lineWidth = 8;
                ctx.stroke();
                
                // ì‹œê°„ì— ë”°ë¥¸ ë‹¨ê³„ë³„ ì‹œë‚˜ë¦¬ì˜¤
                const timePercent = frame / totalFrames;
                const currentSecond = Math.floor(timePercent * 30);
                
                if (currentSecond >= 5 && currentSecond <= 8) {
                    // GFX ì˜¤ë²„ë ˆì´ ì‹œë®¬ë ˆì´ì…˜ (5-8ì´ˆ)
                    drawGFXOverlay('HAND #1 - PREFLOP', '#ff4444');
                } else if (currentSecond >= 15 && currentSecond <= 18) {
                    // ë‘ ë²ˆì§¸ GFX ì˜¤ë²„ë ˆì´ (15-18ì´ˆ)
                    drawGFXOverlay('HAND #2 - ALL IN!', '#ff4444');
                } else if (currentSecond >= 25 && currentSecond <= 28) {
                    // ì„¸ ë²ˆì§¸ GFX ì˜¤ë²„ë ˆì´ (25-28ì´ˆ)
                    drawGFXOverlay('HAND #3 - SHOWDOWN', '#ff4444');
                } else {
                    // ì¼ë°˜ ê²Œì„ í™”ë©´
                    drawGameElements(currentSecond);
                }
                
                // ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜
                drawCards(currentSecond);
                
                // ì¹© ì• ë‹ˆë©”ì´ì…˜
                drawChips(currentSecond);
                
                // ì‹œê°„ í‘œì‹œ
                ctx.fillStyle = '#ffffff';
                ctx.font = '16px Arial';
                ctx.fillText(`Time: ${currentSecond}s`, 10, 30);
                
                frame++;
                if (frame < totalFrames) {
                    requestAnimationFrame(draw);
                }
            }
            
            draw();
        }
        
        function drawGFXOverlay(text, color) {
            // ë°˜íˆ¬ëª… ì˜¤ë²„ë ˆì´ ë°°ê²½
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // GFX í…ìŠ¤íŠ¸
            ctx.fillStyle = color;
            ctx.font = 'bold 32px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(text, canvas.width/2, canvas.height/2);
            
            // ì¥ì‹ì  í…Œë‘ë¦¬
            ctx.strokeStyle = color;
            ctx.lineWidth = 4;
            ctx.strokeRect(50, canvas.height/2 - 40, canvas.width - 100, 80);
            
            ctx.textAlign = 'left'; // ë¦¬ì…‹
        }
        
        function drawGameElements(second) {
            // í”Œë ˆì´ì–´ ìœ„ì¹˜ í‘œì‹œ
            const playerPositions = [
                {x: canvas.width/2, y: 50, name: 'Player 1'},
                {x: canvas.width - 80, y: canvas.height/2, name: 'Player 2'},
                {x: canvas.width/2, y: canvas.height - 50, name: 'Player 3'},
                {x: 80, y: canvas.height/2, name: 'Player 4'}
            ];
            
            playerPositions.forEach((pos, idx) => {
                // í”Œë ˆì´ì–´ ì›
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, 25, 0, 2 * Math.PI);
                ctx.fillStyle = second % 4 === idx ? '#ffff00' : '#ffffff';
                ctx.fill();
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // í”Œë ˆì´ì–´ ì´ë¦„
                ctx.fillStyle = '#ffffff';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(pos.name, pos.x, pos.y - 35);
            });
        }
        
        function drawCards(second) {
            // ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ ì˜ì—­ (í”Œë, í„´, ë¦¬ë²„)
            const cardY = canvas.height/2 - 20;
            const startX = canvas.width/2 - 100;
            
            for (let i = 0; i < 5; i++) {
                if (second > 10 + i * 2) { // 10ì´ˆë¶€í„° ì¹´ë“œê°€ í•˜ë‚˜ì”© ë‚˜íƒ€ë‚¨
                    // ì¹´ë“œ ê·¸ë¦¬ê¸°
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(startX + i * 40, cardY, 30, 42);
                    ctx.strokeStyle = '#000000';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(startX + i * 40, cardY, 30, 42);
                    
                    // ì¹´ë“œ ê°’ (ì„ì˜)
                    ctx.fillStyle = i % 2 === 0 ? '#ff0000' : '#000000';
                    ctx.font = '14px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(['Aâ™ ', 'Kâ™¥', 'Qâ™¦', 'Jâ™£', '10â™ '][i], 
                               startX + i * 40 + 15, cardY + 25);
                }
            }
        }
        
        function drawChips(second) {
            // íŒŸ ì‚¬ì´ì¦ˆ í‘œì‹œ (ì¤‘ì•™)
            const potSize = Math.floor(second * 1000 + Math.random() * 5000);
            ctx.fillStyle = '#ffff00';
            ctx.font = '20px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`POT: $${potSize.toLocaleString()}`, canvas.width/2, canvas.height/2 + 70);
            
            // ì¹© ìŠ¤íƒë“¤
            for (let i = 0; i < 4; i++) {
                const chipX = 150 + i * 100;
                const chipY = canvas.height - 100;
                
                // ì¹© ìŠ¤íƒ
                for (let j = 0; j < 5; j++) {
                    ctx.beginPath();
                    ctx.arc(chipX, chipY - j * 3, 15, 0, 2 * Math.PI);
                    ctx.fillStyle = ['#ff0000', '#00ff00', '#0000ff', '#ffff00'][i % 4];
                    ctx.fill();
                    ctx.strokeStyle = '#ffffff';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                }
            }
        }
        
        function downloadBlob(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>