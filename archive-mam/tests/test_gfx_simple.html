<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>GFX ì˜¤ë²„ë ˆì´ í•™ìŠµê¸° ê°„ë‹¨ í…ŒìŠ¤íŠ¸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .test-pass {
            color: #28a745;
            font-weight: bold;
        }
        .test-fail {
            color: #dc3545;
            font-weight: bold;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .test-result.pass {
            border-left-color: #28a745;
        }
        .test-result.fail {
            border-left-color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1>ğŸ§ª GFX ì˜¤ë²„ë ˆì´ í•™ìŠµê¸° ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h1>
        <hr>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">í…ŒìŠ¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">í˜„ì¬ ì‹œê°„ (ì´ˆ)</label>
                            <input type="number" id="currentTime" class="form-control" value="0" min="0" step="1">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">ë¹„ë””ì˜¤ ì´ ê¸¸ì´ (ì´ˆ)</label>
                            <input type="number" id="videoDuration" class="form-control" value="600" min="1">
                        </div>
                        
                        <button class="btn btn-danger btn-lg w-100" id="gfxToggleBtn" onclick="toggleGFX()">
                            ğŸ“º GFX ì˜¤ë²„ë ˆì´ ì¸ì‹ (í´ë¦­: ì‹œì‘ì  ë§ˆí‚¹)
                        </button>
                        
                        <div class="alert alert-info mt-3" id="segmentInfo" style="display: none;">
                            <strong>í˜„ì¬ êµ¬ê°„:</strong> <span id="segmentStatus">ëŒ€ê¸° ì¤‘</span><br>
                            <strong>ì‹œì‘ì :</strong> <span id="segmentStart">-</span><br>
                            <strong>ì¢…ë£Œì :</strong> <span id="segmentEnd">-</span><br>
                            <strong>í•¸ë“œ êµ¬ê°„:</strong> <span id="handSegment">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">ì €ì¥ëœ êµ¬ê°„</h5>
                    </div>
                    <div class="card-body" id="segmentsList">
                        <p class="text-muted">ì•„ì§ ì €ì¥ëœ êµ¬ê°„ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">ìë™ í…ŒìŠ¤íŠ¸ ê²°ê³¼</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary mb-3" onclick="runAutoTests()">
                            ğŸš€ ìë™ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
                        </button>
                        <div id="testResults"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-4">
            <a href="../web-ui/gfx_overlay_trainer.html" class="btn btn-success" target="_blank">
                ğŸ° ì‹¤ì œ GFX ì˜¤ë²„ë ˆì´ í•™ìŠµê¸° ì—´ê¸°
            </a>
        </div>
    </div>
    
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let segments = [];
        let currentSegment = null;
        let isMarkingStart = true;
        
        // ì‹œê°„ í¬ë§·
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        // GFX í† ê¸€
        function toggleGFX() {
            const currentTime = parseFloat(document.getElementById('currentTime').value);
            const videoDuration = parseFloat(document.getElementById('videoDuration').value);
            const btn = document.getElementById('gfxToggleBtn');
            const segmentInfo = document.getElementById('segmentInfo');
            
            if (isMarkingStart) {
                // ì‹œì‘ì  ë§ˆí‚¹
                currentSegment = {
                    gfxStart: currentTime,
                    gfxEnd: null,
                    handStart: null,
                    handEnd: null,
                    id: Date.now()
                };
                
                btn.textContent = 'ğŸ“º GFX ì˜¤ë²„ë ˆì´ ì¸ì‹ (í´ë¦­: ì¢…ë£Œì  ë§ˆí‚¹)';
                btn.classList.remove('btn-danger');
                btn.classList.add('btn-warning');
                
                segmentInfo.style.display = 'block';
                document.getElementById('segmentStatus').textContent = 'GFX êµ¬ê°„ ë§ˆí‚¹ ì¤‘...';
                document.getElementById('segmentStart').textContent = formatTime(currentSegment.gfxStart);
                document.getElementById('segmentEnd').textContent = 'ëŒ€ê¸° ì¤‘...';
                
                isMarkingStart = false;
                
            } else {
                // ì¢…ë£Œì  ë§ˆí‚¹
                if (!currentSegment) return;
                
                currentSegment.gfxEnd = currentTime;
                
                // 15ì´ˆ ê·œì¹™ ì ìš©
                currentSegment.handStart = Math.max(0, currentSegment.gfxStart - 15);
                currentSegment.handEnd = Math.min(videoDuration, currentSegment.gfxEnd + 15);
                
                segments.push(currentSegment);
                
                btn.textContent = 'ğŸ“º GFX ì˜¤ë²„ë ˆì´ ì¸ì‹ (í´ë¦­: ì‹œì‘ì  ë§ˆí‚¹)';
                btn.classList.remove('btn-warning');
                btn.classList.add('btn-danger');
                
                document.getElementById('segmentStatus').textContent = 'êµ¬ê°„ ì €ì¥ ì™„ë£Œ!';
                document.getElementById('segmentEnd').textContent = formatTime(currentSegment.gfxEnd);
                document.getElementById('handSegment').textContent = 
                    `${formatTime(currentSegment.handStart)} ~ ${formatTime(currentSegment.handEnd)}`;
                
                updateSegmentsList();
                currentSegment = null;
                isMarkingStart = true;
            }
        }
        
        // êµ¬ê°„ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateSegmentsList() {
            const list = document.getElementById('segmentsList');
            
            if (segments.length === 0) {
                list.innerHTML = '<p class="text-muted">ì•„ì§ ì €ì¥ëœ êµ¬ê°„ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            let html = '';
            segments.forEach((seg, idx) => {
                html += `
                    <div class="card mb-2">
                        <div class="card-body">
                            <h6>êµ¬ê°„ ${idx + 1}</h6>
                            <small>
                                GFX: ${formatTime(seg.gfxStart)} ~ ${formatTime(seg.gfxEnd)}<br>
                                í•¸ë“œ: ${formatTime(seg.handStart)} ~ ${formatTime(seg.handEnd)}<br>
                                ê¸¸ì´: ${formatTime(seg.handEnd - seg.handStart)}
                            </small>
                        </div>
                    </div>
                `;
            });
            list.innerHTML = html;
        }
        
        // ìë™ í…ŒìŠ¤íŠ¸
        function runAutoTests() {
            const results = document.getElementById('testResults');
            results.innerHTML = '';
            
            const tests = [
                {
                    name: "15ì´ˆ ê·œì¹™ í…ŒìŠ¤íŠ¸",
                    test: () => {
                        // í…ŒìŠ¤íŠ¸ ë°ì´í„°
                        const testGfxStart = 30;
                        const testGfxEnd = 45;
                        const expectedHandStart = 15;  // 30 - 15
                        const expectedHandEnd = 60;    // 45 + 15
                        
                        const handStart = Math.max(0, testGfxStart - 15);
                        const handEnd = testGfxEnd + 15;
                        
                        return handStart === expectedHandStart && handEnd === expectedHandEnd;
                    }
                },
                {
                    name: "ê²½ê³„ê°’ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸",
                    test: () => {
                        // ì‹œì‘ ê²½ê³„
                        const testGfxStart = 10;  // -15í•˜ë©´ ìŒìˆ˜
                        const handStart = Math.max(0, testGfxStart - 15);
                        
                        return handStart === 0;  // 0ì´ì–´ì•¼ í•¨
                    }
                },
                {
                    name: "ë²„íŠ¼ í† ê¸€ í…ŒìŠ¤íŠ¸",
                    test: () => {
                        const btn = document.getElementById('gfxToggleBtn');
                        const initialText = btn.textContent;
                        
                        // ì‹œì‘ì  í´ë¦­ ì‹œë®¬ë ˆì´ì…˜
                        if (isMarkingStart) {
                            toggleGFX();
                            const afterFirstClick = btn.textContent;
                            
                            // ì¢…ë£Œì  í´ë¦­ ì‹œë®¬ë ˆì´ì…˜
                            document.getElementById('currentTime').value = 50;
                            toggleGFX();
                            const afterSecondClick = btn.textContent;
                            
                            return initialText !== afterFirstClick && 
                                   afterFirstClick !== afterSecondClick &&
                                   initialText === afterSecondClick;
                        }
                        return false;
                    }
                },
                {
                    name: "êµ¬ê°„ ì €ì¥ í…ŒìŠ¤íŠ¸",
                    test: () => {
                        const initialCount = segments.length;
                        
                        // êµ¬ê°„ ì¶”ê°€ ì‹œë®¬ë ˆì´ì…˜
                        document.getElementById('currentTime').value = 100;
                        toggleGFX();  // ì‹œì‘
                        document.getElementById('currentTime').value = 120;
                        toggleGFX();  // ì¢…ë£Œ
                        
                        return segments.length === initialCount + 1;
                    }
                },
                {
                    name: "ì‹œê°„ í¬ë§· í…ŒìŠ¤íŠ¸",
                    test: () => {
                        const formatted = formatTime(125);  // 2:05
                        return formatted === "2:05";
                    }
                }
            ];
            
            let passCount = 0;
            
            tests.forEach(test => {
                try {
                    const passed = test.test();
                    passCount += passed ? 1 : 0;
                    
                    const resultDiv = document.createElement('div');
                    resultDiv.className = `test-result ${passed ? 'pass' : 'fail'}`;
                    resultDiv.innerHTML = `
                        <span class="${passed ? 'test-pass' : 'test-fail'}">
                            ${passed ? 'âœ…' : 'âŒ'} ${test.name}
                        </span>
                    `;
                    results.appendChild(resultDiv);
                } catch (error) {
                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'test-result fail';
                    resultDiv.innerHTML = `
                        <span class="test-fail">
                            âŒ ${test.name} - ì˜¤ë¥˜: ${error.message}
                        </span>
                    `;
                    results.appendChild(resultDiv);
                }
            });
            
            // ê²°ê³¼ ìš”ì•½
            const summary = document.createElement('div');
            summary.className = 'alert alert-info mt-3';
            summary.innerHTML = `
                <strong>í…ŒìŠ¤íŠ¸ ê²°ê³¼:</strong> ${passCount}/${tests.length} í†µê³¼
                (${Math.round(passCount/tests.length * 100)}%)
            `;
            results.appendChild(summary);
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        window.onload = () => {
            console.log('GFX ì˜¤ë²„ë ˆì´ í•™ìŠµê¸° í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
        };
    </script>
</body>
</html>