<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸƒ í¬ì»¤ í•¸ë“œ ë¶„ë¥˜ê¸° - ìë™ í•¸ë“œ ê°ì§€ ì‹œìŠ¤í…œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #0d1117;
            color: #c9d1d9;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .navbar-dark {
            background-color: #161b22 !important;
        }
        .card {
            background-color: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
        }
        .card:hover {
            border-color: #58a6ff;
            box-shadow: 0 0 10px rgba(88, 166, 255, 0.1);
            transition: all 0.3s ease;
        }
        .btn-primary {
            background-color: #238636;
            border-color: #238636;
        }
        .btn-primary:hover {
            background-color: #2ea043;
            border-color: #2ea043;
        }
        .btn-success {
            background-color: #1f6feb;
            border-color: #1f6feb;
        }
        .btn-success:hover {
            background-color: #388bfd;
            border-color: #388bfd;
        }
        .btn-danger {
            background-color: #f85149;
            border-color: #f85149;
        }
        .form-control, .form-select {
            background-color: #21262d;
            border-color: #30363d;
            color: #c9d1d9;
        }
        .form-control:focus, .form-select:focus {
            background-color: #21262d;
            border-color: #58a6ff;
            color: #c9d1d9;
            box-shadow: 0 0 0 0.25rem rgba(88, 166, 255, 0.25);
        }
        #videoCanvas {
            max-width: 100%;
            border: 2px solid #30363d;
            border-radius: 6px;
            background-color: #000;
        }
        .progress {
            height: 25px;
            background-color: #21262d;
        }
        .progress-bar {
            background-color: #238636;
            font-weight: bold;
        }
        .alert-custom {
            background-color: #1c2128;
            border: 1px solid #30363d;
            color: #c9d1d9;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .stat-card {
            text-align: center;
            padding: 20px;
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #58a6ff;
        }
        .stat-label {
            font-size: 0.9rem;
            color: #8b949e;
            margin-top: 5px;
        }
        .hand-item {
            padding: 12px 15px;
            margin: 8px 0;
            background-color: #21262d;
            border-radius: 8px;
            border-left: 4px solid #238636;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .hand-item:hover {
            background-color: #30363d;
            transform: translateX(5px);
        }
        .hand-item.long-hand {
            border-left-color: #f85149;
        }
        .hand-item.short-hand {
            border-left-color: #ffa724;
        }
        .timeline-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            background-color: #0d1117;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark">
        <div class="container">
            <span class="navbar-brand mb-0 h1">ğŸƒ í¬ì»¤ í•¸ë“œ ë¶„ë¥˜ê¸°</span>
            <div>
                <a href="index.html" class="btn btn-outline-light btn-sm me-2">ë©”ì¸</a>
                <a href="web-ui/gfx_overlay_trainer.html" class="btn btn-outline-light btn-sm">GFX í•™ìŠµê¸°</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
        <div class="alert alert-custom mb-4">
            <h5>ğŸ¯ 15ì´ˆ ê·œì¹™ ê¸°ë°˜ ìë™ í•¸ë“œ ë¶„ë¥˜</h5>
            <p class="mb-0">
                í•™ìŠµëœ GFX ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ í¬ì»¤ ì˜ìƒì„ ìë™ìœ¼ë¡œ ë¶„ì„í•˜ê³  í•¸ë“œë³„ë¡œ ë¶„ë¥˜í•©ë‹ˆë‹¤.
                GFX ì¶œí˜„ -15ì´ˆ = í•¸ë“œ ì‹œì‘, GFX ì†Œë©¸ +15ì´ˆ = í•¸ë“œ ì¢…ë£Œì ìœ¼ë¡œ ì •í™•í•œ ê²½ê³„ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.
            </p>
        </div>

        <div class="row">
            <!-- ì™¼ìª½: ë¶„ì„ ì„¤ì • -->
            <div class="col-lg-6">
                <!-- ëª¨ë¸ ë° ë¹„ë””ì˜¤ ë¡œë“œ -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">ğŸ“ íŒŒì¼ ë¡œë“œ</h5>
                        
                        <!-- GFX ëª¨ë¸ ë¡œë“œ -->
                        <div class="mb-3">
                            <label class="form-label">GFX í•™ìŠµ ëª¨ë¸</label>
                            <div class="input-group">
                                <input type="file" class="form-control" id="modelInput" 
                                       accept=".json" onchange="handleModelUpload(event)">
                                <button class="btn btn-outline-secondary" onclick="loadFromLocalStorage()">
                                    ğŸ’¾ ë¡œì»¬ ì €ì¥ì†Œ
                                </button>
                            </div>
                            <div class="small text-muted mt-1" id="modelStatus">ëª¨ë¸ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</div>
                        </div>
                        
                        <!-- ë¹„ë””ì˜¤ ë¡œë“œ -->
                        <div class="mb-3">
                            <label class="form-label">ë¶„ì„í•  ë¹„ë””ì˜¤ íŒŒì¼</label>
                            <input type="file" class="form-control" id="videoInput" 
                                   accept="video/*" onchange="handleVideoUpload(event)">
                        </div>
                        
                        <!-- ë¶„ì„ ì‹œì‘ -->
                        <button class="btn btn-primary w-100" id="startAnalysisBtn" 
                                onclick="startHandClassification()" disabled>
                            ğŸ¯ í•¸ë“œ ë¶„ë¥˜ ì‹œì‘
                        </button>
                    </div>
                </div>

                <!-- ë¶„ì„ ì„¤ì • -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">âš™ï¸ ë¶„ì„ ì„¤ì •</h5>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">ì‹ ë¢°ë„ ì„ê³„ê°’</label>
                                <input type="range" class="form-range" id="confidenceThreshold" 
                                       min="0.5" max="0.95" step="0.05" value="0.75" 
                                       oninput="updateThresholdDisplay()">
                                <div class="small text-muted"><span id="thresholdValue">75</span>%</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">í”„ë ˆì„ ìŠ¤í‚µ</label>
                                <select class="form-select" id="frameSkip">
                                    <option value="5">5 (ê³ ì •ë°€)</option>
                                    <option value="10" selected>10 (ê¶Œì¥)</option>
                                    <option value="15">15 (ê³ ì†)</option>
                                    <option value="30">30 (ì´ˆê³ ì†)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">ìµœì†Œ í•¸ë“œ ê¸¸ì´ (ì´ˆ)</label>
                                <input type="number" class="form-control" id="minHandDuration" 
                                       value="60" min="30" max="300">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">ìµœëŒ€ í•¸ë“œ ê¸¸ì´ (ì´ˆ)</label>
                                <input type="number" class="form-control" id="maxHandDuration" 
                                       value="600" min="300" max="1200">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ë¹„ë””ì˜¤ ë¯¸ë¦¬ë³´ê¸° -->
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">ğŸ“¹ ë¹„ë””ì˜¤ ë¯¸ë¦¬ë³´ê¸°</h5>
                        <canvas id="videoCanvas" width="480" height="270"></canvas>
                        
                        <div class="row mt-3">
                            <div class="col-6">
                                <button class="btn btn-secondary w-100" id="playBtn" 
                                        onclick="playVideo()" disabled>â–¶ï¸ ì¬ìƒ</button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-secondary w-100" id="pauseBtn" 
                                        onclick="pauseVideo()" disabled>â¸ï¸ ì¼ì‹œì •ì§€</button>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <input type="range" class="form-range" id="timelineSlider" 
                                   min="0" max="100" value="0" disabled oninput="seekVideo(this.value)">
                            <div class="d-flex justify-content-between small text-muted">
                                <span id="currentTime">0:00</span>
                                <span id="totalTime">0:00</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ë¶„ì„ ê²°ê³¼ -->
            <div class="col-lg-6">
                <!-- ë¶„ì„ ì§„í–‰ ìƒí™© -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">ğŸ“Š ë¶„ì„ ì§„í–‰ ìƒí™©</h5>
                        
                        <div class="mb-3">
                            <div class="d-flex justify-content-between">
                                <span>ì§„í–‰ë¥ </span>
                                <span id="progressPercent">0%</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar" id="progressBar" style="width: 0%">0%</div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-6">
                                <div class="small text-muted">í˜„ì¬ ì‹œê°„</div>
                                <div id="currentAnalysisTime">-</div>
                            </div>
                            <div class="col-6">
                                <div class="small text-muted">ê°ì§€ëœ í•¸ë“œ</div>
                                <div id="detectedHands">0</div>
                            </div>
                        </div>
                        
                        <div class="mt-2 small text-muted" id="analysisStatus">ëŒ€ê¸° ì¤‘...</div>
                    </div>
                </div>

                <!-- ë¶„ì„ í†µê³„ -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">ğŸ“ˆ ë¶„ì„ í†µê³„</h5>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="totalHands">0</div>
                                <div class="stat-label">ì´ í•¸ë“œ</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="longHands">0</div>
                                <div class="stat-label">ê¸´ í•¸ë“œ</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="shortHands">0</div>
                                <div class="stat-label">ì§§ì€ í•¸ë“œ</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="avgDuration">0s</div>
                                <div class="stat-label">í‰ê·  ê¸¸ì´</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì•¡ì…˜ ë²„íŠ¼ -->
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">ğŸ”§ ì‘ì—…</h5>
                        <div class="d-grid gap-2">
                            <button class="btn btn-success" onclick="exportResults()" id="exportBtn" disabled>
                                ğŸ’¾ ê²°ê³¼ ë‚´ë³´ë‚´ê¸° (JSON)
                            </button>
                            <button class="btn btn-secondary" onclick="previewResults()">
                                ğŸ‘ï¸ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°
                            </button>
                            <button class="btn btn-outline-danger" onclick="clearResults()">
                                ğŸ—‘ï¸ ê²°ê³¼ ì´ˆê¸°í™”
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- í•¸ë“œ ëª©ë¡ -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="card-title mb-0">ğŸƒ ê°ì§€ëœ í•¸ë“œ ëª©ë¡</h5>
                            <div class="btn-group btn-group-sm">
                                <input type="radio" class="btn-check" name="handFilter" id="filterAll" checked>
                                <label class="btn btn-outline-secondary" for="filterAll">ì „ì²´</label>
                                
                                <input type="radio" class="btn-check" name="handFilter" id="filterLong">
                                <label class="btn btn-outline-danger" for="filterLong">ê¸´ í•¸ë“œ</label>
                                
                                <input type="radio" class="btn-check" name="handFilter" id="filterShort">
                                <label class="btn btn-outline-warning" for="filterShort">ì§§ì€ í•¸ë“œ</label>
                            </div>
                        </div>
                        
                        <div class="timeline-container" id="handsContainer">
                            <div class="text-muted text-center py-4">
                                ë¶„ì„ì„ ì‹œì‘í•˜ë©´ ê°ì§€ëœ í•¸ë“œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let gfxModel = null;
        let video = null;
        let canvas = null;
        let ctx = null;
        let isPlaying = false;
        let animationId = null;
        let analysisResults = [];
        let isAnalyzing = false;

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            canvas = document.getElementById('videoCanvas');
            ctx = canvas.getContext('2d');
            
            // í•„í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.querySelectorAll('input[name="handFilter"]').forEach(radio => {
                radio.addEventListener('change', updateHandsDisplay);
            });
            
            updateThresholdDisplay();
            console.log('í¬ì»¤ í•¸ë“œ ë¶„ë¥˜ê¸° ì´ˆê¸°í™” ì™„ë£Œ');
        });

        // ì„ê³„ê°’ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateThresholdDisplay() {
            const value = Math.round(parseFloat(document.getElementById('confidenceThreshold').value) * 100);
            document.getElementById('thresholdValue').textContent = value;
        }

        // GFX ëª¨ë¸ ì—…ë¡œë“œ
        function handleModelUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    gfxModel = JSON.parse(e.target.result);
                    document.getElementById('modelStatus').textContent = 
                        `ëª¨ë¸ ë¡œë“œ ì™„ë£Œ: ${gfxModel.samples?.length || 0}ê°œ ìƒ˜í”Œ`;
                    document.getElementById('modelStatus').className = 'small text-success mt-1';
                    checkAnalysisReady();
                } catch (error) {
                    alert('ëª¨ë¸ íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    console.error('ëª¨ë¸ ë¡œë“œ ì˜¤ë¥˜:', error);
                }
            };
            reader.readAsText(file);
        }

        // ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ëª¨ë¸ ë¡œë“œ
        function loadFromLocalStorage() {
            const savedModel = localStorage.getItem('gfxModel');
            if (savedModel) {
                try {
                    gfxModel = JSON.parse(savedModel);
                    document.getElementById('modelStatus').textContent = 
                        `ë¡œì»¬ ëª¨ë¸ ë¡œë“œ ì™„ë£Œ: ${gfxModel.samples?.length || 0}ê°œ ìƒ˜í”Œ`;
                    document.getElementById('modelStatus').className = 'small text-success mt-1';
                    checkAnalysisReady();
                } catch (error) {
                    alert('ì €ì¥ëœ ëª¨ë¸ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } else {
                alert('ì €ì¥ëœ GFX ëª¨ë¸ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € GFX í•™ìŠµê¸°ì—ì„œ ëª¨ë¸ì„ í•™ìŠµì‹œì¼œ ì£¼ì„¸ìš”.');
            }
        }

        // ë¹„ë””ì˜¤ ì—…ë¡œë“œ
        function handleVideoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            video = document.createElement('video');
            video.src = URL.createObjectURL(file);
            video.addEventListener('loadedmetadata', () => {
                // ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •
                const aspectRatio = video.videoWidth / video.videoHeight;
                const maxWidth = 480;
                const maxHeight = 270;
                
                if (aspectRatio > maxWidth / maxHeight) {
                    canvas.width = maxWidth;
                    canvas.height = maxWidth / aspectRatio;
                } else {
                    canvas.height = maxHeight;
                    canvas.width = maxHeight * aspectRatio;
                }
                
                // ì»¨íŠ¸ë¡¤ í™œì„±í™”
                enableVideoControls();
                
                // ì²« í”„ë ˆì„ ê·¸ë¦¬ê¸°
                drawFrame();
                
                // íƒ€ì„ë¼ì¸ ì„¤ì •
                document.getElementById('timelineSlider').max = video.duration;
                document.getElementById('totalTime').textContent = formatTime(video.duration);
                
                checkAnalysisReady();
            });
            
            video.addEventListener('timeupdate', updateTimeline);
        }

        // ë¶„ì„ ì¤€ë¹„ ìƒíƒœ í™•ì¸
        function checkAnalysisReady() {
            const ready = gfxModel && video;
            document.getElementById('startAnalysisBtn').disabled = !ready;
        }

        // ë¹„ë””ì˜¤ ì»¨íŠ¸ë¡¤ í™œì„±í™”
        function enableVideoControls() {
            document.getElementById('playBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = false;
            document.getElementById('timelineSlider').disabled = false;
        }

        // í”„ë ˆì„ ê·¸ë¦¬ê¸°
        function drawFrame() {
            if (!video) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        }

        // ë¹„ë””ì˜¤ ì¬ìƒ
        function playVideo() {
            if (!video) return;
            video.play();
            isPlaying = true;
            animate();
        }

        // ë¹„ë””ì˜¤ ì¼ì‹œì •ì§€
        function pauseVideo() {
            if (!video) return;
            video.pause();
            isPlaying = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
        }

        // ë¹„ë””ì˜¤ ì´ë™
        function seekVideo(value) {
            if (!video) return;
            video.currentTime = (value / 100) * video.duration;
            drawFrame();
        }

        // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
        function animate() {
            if (isPlaying) {
                drawFrame();
                animationId = requestAnimationFrame(animate);
            }
        }

        // íƒ€ì„ë¼ì¸ ì—…ë°ì´íŠ¸
        function updateTimeline() {
            if (!video) return;
            const progress = (video.currentTime / video.duration) * 100;
            document.getElementById('timelineSlider').value = progress;
            document.getElementById('currentTime').textContent = formatTime(video.currentTime);
        }

        // ì‹œê°„ í¬ë§·
        function formatTime(seconds) {
            if (isNaN(seconds) || seconds < 0) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // í•¸ë“œ ë¶„ë¥˜ ì‹œì‘
        async function startHandClassification() {
            if (isAnalyzing || !gfxModel || !video) return;
            
            isAnalyzing = true;
            document.getElementById('startAnalysisBtn').disabled = true;
            analysisResults = [];
            
            try {
                await performHandClassification();
            } catch (error) {
                console.error('ë¶„ì„ ì˜¤ë¥˜:', error);
                alert('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                isAnalyzing = false;
                document.getElementById('startAnalysisBtn').disabled = false;
            }
        }

        // í•¸ë“œ ë¶„ë¥˜ ì‹¤í–‰ (ì‹œë®¬ë ˆì´ì…˜)
        async function performHandClassification() {
            const frameSkip = parseInt(document.getElementById('frameSkip').value);
            const confidenceThreshold = parseFloat(document.getElementById('confidenceThreshold').value);
            const minDuration = parseInt(document.getElementById('minHandDuration').value);
            const maxDuration = parseInt(document.getElementById('maxHandDuration').value);
            
            document.getElementById('analysisStatus').textContent = 'ì˜ìƒ ë¶„ì„ ì¤‘...';
            
            const totalFrames = Math.floor(video.duration * 30); // 30fps ê°€ì •
            const sampleFrames = Math.floor(totalFrames / frameSkip);
            
            let gfxSegments = [];
            let currentGfxStart = null;
            
            // GFX êµ¬ê°„ ê°ì§€ ì‹œë®¬ë ˆì´ì…˜
            for (let i = 0; i < sampleFrames; i++) {
                const timestamp = (i * frameSkip) / 30;
                video.currentTime = timestamp;
                
                await new Promise(resolve => {
                    video.addEventListener('seeked', resolve, { once: true });
                });
                
                drawFrame();
                
                // GFX ê°ì§€ ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œë¡œëŠ” ëª¨ë¸ ì˜ˆì¸¡)
                const isGfx = simulateGfxDetection(timestamp);
                const confidence = Math.random() * 0.4 + 0.6; // 0.6-1.0
                
                if (isGfx && confidence >= confidenceThreshold) {
                    if (currentGfxStart === null) {
                        currentGfxStart = timestamp;
                    }
                } else if (currentGfxStart !== null) {
                    // GFX êµ¬ê°„ ì¢…ë£Œ
                    const gfxEnd = timestamp;
                    const handStart = Math.max(0, currentGfxStart - 15);
                    const handEnd = Math.min(video.duration, gfxEnd + 15);
                    const duration = handEnd - handStart;
                    
                    if (duration >= minDuration && duration <= maxDuration) {
                        gfxSegments.push({
                            handId: gfxSegments.length + 1,
                            handStart: handStart,
                            handEnd: handEnd,
                            duration: duration,
                            gfxStart: currentGfxStart,
                            gfxEnd: gfxEnd,
                            confidence: confidence
                        });
                    }
                    
                    currentGfxStart = null;
                }
                
                // UI ì—…ë°ì´íŠ¸
                const progress = (i / sampleFrames) * 100;
                updateProgress(progress);
                document.getElementById('currentAnalysisTime').textContent = formatTime(timestamp);
                document.getElementById('detectedHands').textContent = gfxSegments.length;
                
                await new Promise(resolve => setTimeout(resolve, 10));
            }
            
            analysisResults = gfxSegments;
            updateProgress(100);
            updateStatistics();
            updateHandsDisplay();
            
            document.getElementById('analysisStatus').textContent = 
                `ë¶„ì„ ì™„ë£Œ - ${gfxSegments.length}ê°œ í•¸ë“œ ê°ì§€`;
            document.getElementById('exportBtn').disabled = false;
        }

        // GFX ê°ì§€ ì‹œë®¬ë ˆì´ì…˜
        function simulateGfxDetection(timestamp) {
            // ì‹œë®¬ë ˆì´ì…˜: íŠ¹ì • ì‹œê°„ëŒ€ì— GFXê°€ ìˆë‹¤ê³  ê°€ì •
            const minute = Math.floor(timestamp / 60);
            const second = Math.floor(timestamp % 60);
            
            // ë§¤ 2-5ë¶„ë§ˆë‹¤ 30-60ì´ˆ ê¸¸ì´ì˜ GFX êµ¬ê°„ ì‹œë®¬ë ˆì´ì…˜
            return (minute % 3 === 0 || minute % 4 === 1) && second >= 10 && second <= 50;
        }

        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateProgress(percent) {
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressPercent');
            
            progressBar.style.width = `${percent}%`;
            progressBar.textContent = `${Math.round(percent)}%`;
            progressText.textContent = `${Math.round(percent)}%`;
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStatistics() {
            const longHandThreshold = 300; // 5ë¶„
            const longHands = analysisResults.filter(h => h.duration > longHandThreshold).length;
            const shortHands = analysisResults.length - longHands;
            const avgDuration = analysisResults.length > 0 ? 
                analysisResults.reduce((sum, h) => sum + h.duration, 0) / analysisResults.length : 0;
            
            document.getElementById('totalHands').textContent = analysisResults.length;
            document.getElementById('longHands').textContent = longHands;
            document.getElementById('shortHands').textContent = shortHands;
            document.getElementById('avgDuration').textContent = `${Math.round(avgDuration)}s`;
        }

        // í•¸ë“œ ëª©ë¡ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateHandsDisplay() {
            const container = document.getElementById('handsContainer');
            const filter = document.querySelector('input[name="handFilter"]:checked').id;
            
            let hands = [...analysisResults];
            const longHandThreshold = 300; // 5ë¶„
            
            // í•„í„° ì ìš©
            switch (filter) {
                case 'filterLong':
                    hands = hands.filter(h => h.duration > longHandThreshold);
                    break;
                case 'filterShort':
                    hands = hands.filter(h => h.duration <= longHandThreshold);
                    break;
            }
            
            if (hands.length === 0) {
                container.innerHTML = '<div class="text-muted text-center py-4">í•„í„°ë§ëœ í•¸ë“œê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            const html = hands.map(hand => {
                const isLongHand = hand.duration > longHandThreshold;
                const className = isLongHand ? 'long-hand' : 'short-hand';
                
                return `
                    <div class="hand-item ${className}" onclick="jumpToHand(${hand.handStart})">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>í•¸ë“œ ${hand.handId}</strong>
                                <span class="text-muted ms-2">${formatTime(hand.handStart)} - ${formatTime(hand.handEnd)}</span>
                            </div>
                            <div class="text-end">
                                <div class="text-warning"><strong>${Math.round(hand.duration)}ì´ˆ</strong></div>
                                <small class="text-muted">ì‹ ë¢°ë„: ${Math.round(hand.confidence * 100)}%</small>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
        }

        // í•¸ë“œë¡œ ì´ë™
        function jumpToHand(startTime) {
            if (video) {
                video.currentTime = startTime;
                drawFrame();
            }
        }

        // ê²°ê³¼ ë‚´ë³´ë‚´ê¸°
        function exportResults() {
            if (analysisResults.length === 0) {
                alert('ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const exportData = {
                type: 'hand_classification',
                timestamp: new Date().toISOString(),
                video_duration: video.duration,
                total_hands: analysisResults.length,
                hands: analysisResults.map(hand => ({
                    hand_id: hand.handId,
                    start_time: hand.handStart,
                    end_time: hand.handEnd,
                    duration: hand.duration,
                    gfx_start: hand.gfxStart,
                    gfx_end: hand.gfxEnd,
                    confidence: hand.confidence
                }))
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `hand_classification_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°
        function previewResults() {
            if (analysisResults.length === 0) {
                alert('ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const preview = analysisResults.slice(0, 5).map(hand => 
                `í•¸ë“œ ${hand.handId}: ${formatTime(hand.handStart)} - ${formatTime(hand.handEnd)} (${Math.round(hand.duration)}ì´ˆ)`
            ).join('\n');
            
            alert(`ê°ì§€ëœ í•¸ë“œ (ìƒìœ„ 5ê°œ):\n\n${preview}\n\nì´ ${analysisResults.length}ê°œ í•¸ë“œê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        // ê²°ê³¼ ì´ˆê¸°í™”
        function clearResults() {
            if (confirm('ë¶„ì„ ê²°ê³¼ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                analysisResults = [];
                updateStatistics();
                updateHandsDisplay();
                updateProgress(0);
                
                document.getElementById('analysisStatus').textContent = 'ëŒ€ê¸° ì¤‘...';
                document.getElementById('currentAnalysisTime').textContent = '-';
                document.getElementById('detectedHands').textContent = '0';
                document.getElementById('exportBtn').disabled = true;
            }
        }
    </script>
</body>
</html>