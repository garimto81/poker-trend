<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Hand Analyzer - ì˜¨ë¼ì¸ í¬ì»¤ ì˜ìƒ ë¶„ì„</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: #1a1a2e;
            color: #eee;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .container {
            max-width: 900px;
            margin-top: 50px;
        }
        .upload-zone {
            border: 3px dashed #4a7c7e;
            border-radius: 20px;
            padding: 60px;
            text-align: center;
            background: #16213e;
            transition: all 0.3s;
        }
        .upload-zone.dragover {
            border-color: #f39c12;
            background: #1e3a5f;
        }
        .btn-analyze {
            background: #e74c3c;
            border: none;
            padding: 12px 40px;
            font-size: 18px;
            border-radius: 30px;
            transition: all 0.3s;
        }
        .btn-analyze:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        .progress-container {
            display: none;
            margin-top: 30px;
        }
        .results {
            display: none;
            margin-top: 30px;
            background: #16213e;
            padding: 30px;
            border-radius: 15px;
        }
        .hand-card {
            background: #0f3460;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid #e74c3c;
            cursor: pointer;
            transition: all 0.3s;
        }
        .hand-card:hover {
            background: #1a4a7a;
            transform: translateX(5px);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-box {
            background: #0f3460;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: #f39c12;
        }
        #videoPreview {
            max-width: 100%;
            margin: 20px 0;
            border-radius: 10px;
        }
        #videoPlayer {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        .video-container {
            background: #0f3460;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-5">ğŸƒ Poker Hand Analyzer v2.0</h1>
        <div class="text-center mb-4">
            <div style="margin: 10px 0;">
                <a href="unified_ui_recognition.html" class="btn btn-danger btn-lg" style="text-decoration: none; font-size: 20px; padding: 15px 30px;">
                    ğŸ¯ í†µí•© UI ì¸ì‹ ì‹œìŠ¤í…œ (NEW!)
                </a>
            </div>
            <p class="text-muted mt-2">ìŠ¤ë§ˆíŠ¸ ëª¨ë“œ + êµ¬ê°„ ë§ˆí‚¹ + í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œë¥¼ í•˜ë‚˜ì˜ ì‹œìŠ¤í…œìœ¼ë¡œ í†µí•©</p>
            
            <hr style="margin: 20px 0; border-color: #333;">
            
            <div style="margin: 10px 0;">
                <a href="ui_segment_learning.html" class="btn btn-success btn-sm" style="text-decoration: none; margin: 5px;">
                    ğŸ¤– AI í•™ìŠµ
                </a>
                <a href="incremental_learning_system.html" class="btn btn-primary btn-sm" style="text-decoration: none; margin: 5px;">
                    ğŸ”„ ì ì§„ì  í•™ìŠµ
                </a>
            </div>
            <p class="text-muted" style="font-size: 12px;">ê³ ê¸‰ ê¸°ëŠ¥: AI ëª¨ë¸ í•™ìŠµ ë° ì§€ì†ì  ê°œì„ </p>
        </div>
        <p class="text-center text-muted mb-5">ğŸ§  ìŠ¤ë§ˆíŠ¸ UI ê°ì§€ - ì‚¬ìš©ìê°€ ì‹œê°„ë§Œ ì•Œë ¤ì£¼ë©´ ì‹œìŠ¤í…œì´ í™”ë©´ì—ì„œ UIë¥¼ ì°¾ì•„ëƒ…ë‹ˆë‹¤</p>
        
        
        <!-- ì—…ë¡œë“œ ì˜ì—­ -->
        <div class="upload-zone" id="uploadZone">
            <h3>ğŸ“¹ í¬ì»¤ ì˜ìƒì„ ì„ íƒí•˜ì„¸ìš”</h3>
            <p class="text-muted">MP4, AVI, MOV í˜•ì‹ ì§€ì› (ìµœëŒ€ 500MB)</p>
            <input type="file" id="videoInput" accept="video/*" class="form-control mb-3" style="max-width: 400px; margin: 0 auto;">
            <div id="fileInfo" class="mt-3"></div>
            <video id="videoPreview" controls style="display: none;"></video>
            <button id="analyzeBtn" class="btn btn-danger btn-analyze mt-3" style="display: none;">
                ğŸš€ ë¶„ì„ ì‹œì‘
            </button>
        </div>

        <!-- ì§„í–‰ë¥  í‘œì‹œ -->
        <div class="progress-container" id="progressContainer">
            <h4>ë¶„ì„ ì¤‘...</h4>
            <div class="progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated" id="progressBar" 
                     role="progressbar" style="width: 0%">0%</div>
            </div>
            <p class="text-muted mt-2" id="progressText">ì˜ìƒì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
        </div>

        <!-- ê²°ê³¼ í‘œì‹œ -->
        <div class="results" id="results">
            <h3>ğŸ“Š ë¶„ì„ ê²°ê³¼</h3>
            
            <!-- ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ -->
            <div class="video-container">
                <h4>ğŸ¬ ì˜ìƒ ì¬ìƒ</h4>
                <video id="videoPlayer" controls></video>
                <p class="text-muted mt-2">í•¸ë“œë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ êµ¬ê°„ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤</p>
            </div>
            
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-number" id="totalHands">0</div>
                    <div>ì´ í•¸ë“œ ìˆ˜</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="avgDuration">0</div>
                    <div>í‰ê·  í•¸ë“œ ì‹œê°„(ì´ˆ)</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="longestHand">0</div>
                    <div>ê°€ì¥ ê¸´ í•¸ë“œ(ì´ˆ)</div>
                </div>
            </div>

            <h4 class="mt-4">ğŸ¯ ê°ì§€ëœ í•¸ë“œ</h4>
            <div id="handsList"></div>
            
            <button class="btn btn-success mt-3" onclick="downloadResults()">
                ğŸ“¥ ê²°ê³¼ ë‹¤ìš´ë¡œë“œ (JSON)
            </button>
        </div>
    </div>

    <script>
        let videoFile = null;
        let analysisResults = null;
        let analysisMode = 'smart'; // ê¸°ë³¸ê°’ì„ ìŠ¤ë§ˆíŠ¸ ëª¨ë“œë¡œ
        let smartUIDetector = null;

        // íŒŒì¼ ì„ íƒ ì²˜ë¦¬
        document.getElementById('videoInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.type.startsWith('video/')) {
                videoFile = file;
                displayVideoInfo(file);
            } else {
                alert('ë¹„ë””ì˜¤ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
            }
        });

        // ë¹„ë””ì˜¤ ì •ë³´ í‘œì‹œ
        function displayVideoInfo(file) {
            const fileInfo = document.getElementById('fileInfo');
            const videoPreview = document.getElementById('videoPreview');
            const analyzeBtn = document.getElementById('analyzeBtn');
            
            fileInfo.innerHTML = `
                <p><strong>íŒŒì¼ëª…:</strong> ${file.name}</p>
                <p><strong>í¬ê¸°:</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB</p>
            `;
            
            // ë¹„ë””ì˜¤ ë¯¸ë¦¬ë³´ê¸°
            const url = URL.createObjectURL(file);
            videoPreview.src = url;
            videoPreview.style.display = 'block';
            analyzeBtn.style.display = 'inline-block';
        }

        // ë¶„ì„ ì‹œì‘
        document.getElementById('analyzeBtn').addEventListener('click', analyzeVideo);
        
        // ëª¨ë“œ ì„¤ì •
        function setMode(mode) {
            analysisMode = mode;
            const autoBtn = document.getElementById('autoModeBtn');
            const smartBtn = document.getElementById('smartModeBtn');
            const description = document.getElementById('modeDescription');
            
            if (mode === 'auto') {
                autoBtn.className = 'btn btn-warning me-3';
                smartBtn.className = 'btn btn-outline-warning';
                description.textContent = 'ìë™ ëª¨ë“œ: ì‹œìŠ¤í…œì´ íœ´ë¦¬ìŠ¤í‹±ìœ¼ë¡œ í•¸ë“œë¥¼ ìë™ ê°ì§€í•©ë‹ˆë‹¤';
            } else {
                autoBtn.className = 'btn btn-outline-warning me-3';
                smartBtn.className = 'btn btn-warning';
                description.textContent = 'ìŠ¤ë§ˆíŠ¸ ëª¨ë“œ: UI ì‹œì‘/ì¢…ë£Œë§Œ ì•Œë ¤ì£¼ë©´ ì‹œìŠ¤í…œì´ í™”ë©´ ìœ„ì¹˜ë¥¼ ìë™ ê°ì§€í•©ë‹ˆë‹¤';
            }
        }

        async function analyzeVideo() {
            if (!videoFile) return;
            
            if (analysisMode === 'smart') {
                // ìŠ¤ë§ˆíŠ¸ ëª¨ë“œ: UI ë§ˆí‚¹ ì¸í„°í˜ì´ìŠ¤ë¡œ ì „í™˜
                startSmartAnalysis();
            } else {
                // ìë™ ëª¨ë“œ: ê¸°ì¡´ ë°©ì‹
                document.getElementById('uploadZone').style.display = 'none';
                document.getElementById('progressContainer').style.display = 'block';
                await simulateAnalysis();
            }
        }
        
        // ìŠ¤ë§ˆíŠ¸ ë¶„ì„ ì‹œì‘
        function startSmartAnalysis() {
            document.getElementById('uploadZone').style.display = 'none';
            document.getElementById('modeSelection').style.display = 'none';
            
            // ìŠ¤ë§ˆíŠ¸ UI ì¸í„°í˜ì´ìŠ¤ í‘œì‹œ
            showSmartInterface();
        }
        
        // ìŠ¤ë§ˆíŠ¸ ì¸í„°í˜ì´ìŠ¤ í‘œì‹œ
        function showSmartInterface() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'block';
            
            // ê¸°ì¡´ ê²°ê³¼ ë‚´ìš©ì„ ìŠ¤ë§ˆíŠ¸ ì¸í„°í˜ì´ìŠ¤ë¡œ êµì²´
            resultsDiv.innerHTML = `
                <h3>ğŸ§  ìŠ¤ë§ˆíŠ¸ UI ê°ì§€ ëª¨ë“œ</h3>
                <p class="text-muted">UIê°€ ë‚˜íƒ€ë‚˜ë©´ "UI ê°ì§€ ì‹œì‘", ì‚¬ë¼ì§€ë©´ "UI ê°ì§€ ì¢…ë£Œ"ë¥¼ í´ë¦­í•˜ì„¸ìš”</p>
                
                <!-- ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ -->
                <div class="video-container" style="position: relative;">
                    <h4>ğŸ¬ ì˜ìƒ ì¬ìƒ</h4>
                    <div style="position: relative; display: inline-block;">
                        <video id="smartVideoPlayer" controls style="width: 100%; max-width: 600px; border-radius: 10px;"></video>
                        <canvas id="analysisOverlay" style="position: absolute; top: 0; left: 0; pointer-events: none; border-radius: 10px;"></canvas>
                    </div>
                    
                    <!-- ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë¡¤ -->
                    <div style="text-align: center; margin: 20px 0;">
                        <button id="smartDetectBtn" onclick="toggleSmartDetection()" style="background: linear-gradient(45deg, #e74c3c, #f39c12); color: white; border: none; padding: 15px 30px; font-size: 20px; border-radius: 25px; cursor: pointer; min-width: 200px;">
                            ğŸ” UI ê°ì§€ ì‹œì‘
                        </button>
                    </div>
                </div>
                
                <!-- ë¶„ì„ ê²°ê³¼ -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <h5>ğŸ“Š í™”ë©´ ì˜ì—­ ë¶„ì„</h5>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px 0;">
                            <div class="detection-cell" id="smart-cell-0" style="background: #0f3460; padding: 10px; border-radius: 8px; text-align: center; border: 2px solid transparent; font-size: 12px;">ì¢Œìƒë‹¨<br><span id="smart-score-0">0%</span></div>
                            <div class="detection-cell" id="smart-cell-1" style="background: #0f3460; padding: 10px; border-radius: 8px; text-align: center; border: 2px solid transparent; font-size: 12px;">ìƒë‹¨<br><span id="smart-score-1">0%</span></div>
                            <div class="detection-cell" id="smart-cell-2" style="background: #0f3460; padding: 10px; border-radius: 8px; text-align: center; border: 2px solid transparent; font-size: 12px;">ìš°ìƒë‹¨<br><span id="smart-score-2">0%</span></div>
                            <div class="detection-cell" id="smart-cell-3" style="background: #0f3460; padding: 10px; border-radius: 8px; text-align: center; border: 2px solid transparent; font-size: 12px;">ì¢Œì¸¡<br><span id="smart-score-3">0%</span></div>
                            <div class="detection-cell" id="smart-cell-4" style="background: #0f3460; padding: 10px; border-radius: 8px; text-align: center; border: 2px solid transparent; font-size: 12px;">ì¤‘ì•™<br><span id="smart-score-4">0%</span></div>
                            <div class="detection-cell" id="smart-cell-5" style="background: #0f3460; padding: 10px; border-radius: 8px; text-align: center; border: 2px solid transparent; font-size: 12px;">ìš°ì¸¡<br><span id="smart-score-5">0%</span></div>
                            <div class="detection-cell" id="smart-cell-6" style="background: #0f3460; padding: 10px; border-radius: 8px; text-align: center; border: 2px solid transparent; font-size: 12px;">ì¢Œí•˜ë‹¨<br><span id="smart-score-6">0%</span></div>
                            <div class="detection-cell" id="smart-cell-7" style="background: #0f3460; padding: 10px; border-radius: 8px; text-align: center; border: 2px solid transparent; font-size: 12px;">í•˜ë‹¨<br><span id="smart-score-7">0%</span></div>
                            <div class="detection-cell" id="smart-cell-8" style="background: #0f3460; padding: 10px; border-radius: 8px; text-align: center; border: 2px solid transparent; font-size: 12px;">ìš°í•˜ë‹¨<br><span id="smart-score-8">0%</span></div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h5>ğŸ¯ ê°ì§€ ìƒíƒœ</h5>
                        <div id="smartStatus" style="background: #0f3460; padding: 15px; border-radius: 8px; margin: 10px 0; text-align: center;">
                            ë¹„ë””ì˜¤ë¥¼ ì¬ìƒí•˜ê³  UIê°€ ë‚˜íƒ€ë‚˜ë©´ "UI ê°ì§€ ì‹œì‘" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”
                        </div>
                        
                        <h5>ğŸ“ í•™ìŠµëœ UI íŒ¨í„´</h5>
                        <div id="learnedUIPatterns" style="max-height: 200px; overflow-y: auto; background: #0f3460; padding: 10px; border-radius: 8px;">
                            ì•„ì§ í•™ìŠµëœ íŒ¨í„´ì´ ì—†ìŠµë‹ˆë‹¤
                        </div>
                    </div>
                </div>
                
                <!-- ê²°ê³¼ ì„¹ì…˜ -->
                <div id="smartResults" style="display: none; margin-top: 30px;">
                    <h4>ğŸ¯ ë¶„ì„ ê²°ê³¼</h4>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-number" id="smartTotalUI">0</div>
                            <div>ê°ì§€ëœ UI</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="smartPredictedHands">0</div>
                            <div>ì˜ˆì¸¡ í•¸ë“œ ìˆ˜</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="smartAccuracy">95</div>
                            <div>ì˜ˆìƒ ì •í™•ë„(%)</div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <button class="btn btn-success me-2" onclick="exportSmartResults()">
                            ğŸ“¥ ë¶„ì„ ê²°ê³¼ ë‹¤ìš´ë¡œë“œ (JSON)
                        </button>
                        <button class="btn btn-info me-2" onclick="exportToCSV()">
                            ğŸ“Š CSVë¡œ ë‚´ë³´ë‚´ê¸°
                        </button>
                        <button class="btn btn-warning me-2" onclick="clearStoredPatterns()">
                            ğŸ—‘ï¸ ì €ì¥ëœ íŒ¨í„´ ì‚­ì œ
                        </button>
                        <button class="btn btn-secondary" onclick="importPatterns()">
                            ğŸ“‚ íŒ¨í„´ ê°€ì ¸ì˜¤ê¸°
                        </button>
                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="loadImportedPatterns(event)">
                    </div>
                </div>
            `;
            
            // ë¹„ë””ì˜¤ ì„¤ì •
            const smartVideoPlayer = document.getElementById('smartVideoPlayer');
            smartVideoPlayer.src = URL.createObjectURL(videoFile);
            
            // ìŠ¤ë§ˆíŠ¸ ê°ì§€ê¸° ì´ˆê¸°í™”
            smartVideoPlayer.addEventListener('loadedmetadata', () => {
                const overlay = document.getElementById('analysisOverlay');
                overlay.width = smartVideoPlayer.videoWidth;
                overlay.height = smartVideoPlayer.videoHeight;
                
                smartUIDetector = new SmartUIDetector(smartVideoPlayer, overlay);
                
                // ê¸°ì¡´ ì €ì¥ëœ íŒ¨í„´ ë¡œë“œ
                smartUIDetector.loadFromLocalStorage();
            });
        }

        // ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” OpenCV.js ë˜ëŠ” ì„œë²„ API ì‚¬ìš©)
        async function simulateAnalysis() {
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            // ì§„í–‰ë¥  ì‹œë®¬ë ˆì´ì…˜
            for (let i = 0; i <= 100; i += 5) {
                progressBar.style.width = i + '%';
                progressBar.textContent = i + '%';
                
                if (i < 30) {
                    progressText.textContent = 'ì˜ìƒ í”„ë ˆì„ ì¶”ì¶œ ì¤‘...';
                } else if (i < 60) {
                    progressText.textContent = 'í•¸ë“œ ê²½ê³„ ê°ì§€ ì¤‘...';
                } else if (i < 90) {
                    progressText.textContent = 'í•¸ë“œ ê¸¸ì´ ë¶„ì„ ì¤‘...';
                } else {
                    progressText.textContent = 'ê²°ê³¼ ìƒì„± ì¤‘...';
                }
                
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            // ìƒ˜í”Œ ê²°ê³¼ ìƒì„±
            generateSampleResults();
            displayResults();
        }

        // ìƒ˜í”Œ ê²°ê³¼ ìƒì„±
        function generateSampleResults() {
            const numHands = Math.floor(Math.random() * 15) + 10;
            const hands = [];
            
            for (let i = 1; i <= numHands; i++) {
                const duration = Math.floor(Math.random() * 240) + 30;
                hands.push({
                    id: i,
                    startTime: (i - 1) * 120,
                    endTime: (i - 1) * 120 + duration,
                    duration: duration,
                    category: getCategoryByDuration(duration)
                });
            }
            
            analysisResults = {
                totalHands: numHands,
                hands: hands,
                avgDuration: Math.floor(hands.reduce((sum, h) => sum + h.duration, 0) / numHands),
                longestHand: Math.max(...hands.map(h => h.duration))
            };
        }

        // í•¸ë“œ ì¹´í…Œê³ ë¦¬ ê²°ì •
        function getCategoryByDuration(duration) {
            if (duration < 45) return { name: 'ë§¤ìš° ì§§ìŒ', color: '#e74c3c' };
            if (duration < 90) return { name: 'ì§§ìŒ', color: '#f39c12' };
            if (duration < 180) return { name: 'ë³´í†µ', color: '#3498db' };
            if (duration < 300) return { name: 'ê¹€', color: '#2ecc71' };
            return { name: 'ë§¤ìš° ê¹€', color: '#9b59b6' };
        }

        // ê²°ê³¼ í‘œì‹œ
        function displayResults() {
            document.getElementById('progressContainer').style.display = 'none';
            document.getElementById('results').style.display = 'block';
            
            // ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ì— ì˜ìƒ ì„¤ì •
            const videoPlayer = document.getElementById('videoPlayer');
            videoPlayer.src = URL.createObjectURL(videoFile);
            
            // í†µê³„ í‘œì‹œ
            document.getElementById('totalHands').textContent = analysisResults.totalHands;
            document.getElementById('avgDuration').textContent = analysisResults.avgDuration;
            document.getElementById('longestHand').textContent = analysisResults.longestHand;
            
            // í•¸ë“œ ëª©ë¡ í‘œì‹œ
            const handsList = document.getElementById('handsList');
            handsList.innerHTML = analysisResults.hands.map(hand => `
                <div class="hand-card" onclick="seekToHand(${hand.startTime})">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>í•¸ë“œ #${hand.id}</strong>
                            <span class="badge" style="background: ${hand.category.color}; margin-left: 10px;">
                                ${hand.category.name}
                            </span>
                        </div>
                        <div>
                            <span>${formatTime(hand.startTime)} - ${formatTime(hand.endTime)}</span>
                            <strong class="text-warning ms-3">${hand.duration}ì´ˆ</strong>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // í•¸ë“œ êµ¬ê°„ìœ¼ë¡œ ì´ë™
        function seekToHand(startTime) {
            const videoPlayer = document.getElementById('videoPlayer');
            videoPlayer.currentTime = startTime;
            videoPlayer.play();
            
            // ìŠ¤í¬ë¡¤ì„ ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ë¡œ ì´ë™
            document.querySelector('.video-container').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center' 
            });
        }

        // ì‹œê°„ í¬ë§·
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // ê²°ê³¼ ë‹¤ìš´ë¡œë“œ
        function downloadResults() {
            if (!analysisResults) return;
            
            const dataStr = JSON.stringify(analysisResults, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'poker_analysis_results.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        
        // ìŠ¤ë§ˆíŠ¸ UI ê°ì§€ê¸° í´ë˜ìŠ¤
        class SmartUIDetector {
            constructor(video, canvas) {
                this.video = video;
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.isDetecting = false;
                this.detectionStart = null;
                this.frameAnalysisInterval = null;
                this.uiPatterns = [];
                this.tempCanvas = document.createElement('canvas');
                this.tempCtx = this.tempCanvas.getContext('2d');
            }
            
            startDetection() {
                this.isDetecting = true;
                this.detectionStart = this.video.currentTime;
                
                // ì‹¤ì‹œê°„ ë¶„ì„ ì‹œì‘
                this.frameAnalysisInterval = setInterval(() => {
                    this.analyzeFrame();
                }, 200); // 0.2ì´ˆë§ˆë‹¤
                
                updateSmartStatus('ğŸ”„ UI ê°ì§€ ì¤‘... í™”ë©´ì„ 9ê°œ ì˜ì—­ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤.');
            }
            
            stopDetection() {
                if (!this.isDetecting) return;
                
                this.isDetecting = false;
                clearInterval(this.frameAnalysisInterval);
                
                const detectionEnd = this.video.currentTime;
                const duration = detectionEnd - this.detectionStart;
                
                if (duration >= 3) {
                    this.learnUIPattern(this.detectionStart, detectionEnd);
                    updateSmartStatus(`âœ… UI íŒ¨í„´ í•™ìŠµ ì™„ë£Œ: ${formatTime(this.detectionStart)} - ${formatTime(detectionEnd)} (${Math.floor(duration)}ì´ˆ)`);
                    this.updateResults();
                } else {
                    updateSmartStatus('âš ï¸ ê°ì§€ ì‹œê°„ì´ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤ (ìµœì†Œ 3ì´ˆ ì´ìƒ)');
                }
                
                this.resetGrid();
            }
            
            analyzeFrame() {
                if (!this.isDetecting || this.video.paused) return;
                
                // ë¹„ë””ì˜¤ë¥¼ ì„ì‹œ ìº”ë²„ìŠ¤ì— ê·¸ë¦¬ê¸°
                this.tempCanvas.width = this.video.videoWidth;
                this.tempCanvas.height = this.video.videoHeight;
                this.tempCtx.drawImage(this.video, 0, 0);
                
                const imageData = this.tempCtx.getImageData(0, 0, this.tempCanvas.width, this.tempCanvas.height);
                const regionScores = this.analyzeRegions(imageData);
                
                this.updateDetectionGrid(regionScores);
                this.drawAnalysisOverlay(regionScores);
            }
            
            analyzeRegions(imageData) {
                const regions = [];
                const width = imageData.width;
                const height = imageData.height;
                const data = imageData.data;
                
                // 3x3 ê·¸ë¦¬ë“œë¡œ ë‚˜ëˆ„ê¸°
                for (let row = 0; row < 3; row++) {
                    for (let col = 0; col < 3; col++) {
                        const startX = Math.floor(col * width / 3);
                        const endX = Math.floor((col + 1) * width / 3);
                        const startY = Math.floor(row * height / 3);
                        const endY = Math.floor((row + 1) * height / 3);
                        
                        const regionScore = this.analyzeRegion(data, width, startX, endX, startY, endY);
                        regions.push(regionScore);
                    }
                }
                
                return regions;
            }
            
            analyzeRegion(data, width, startX, endX, startY, endY) {
                let totalPixels = 0;
                let edgePixels = 0;
                let colorCounts = {};
                
                for (let y = startY; y < endY; y++) {
                    for (let x = startX; x < endX; x++) {
                        const idx = (y * width + x) * 4;
                        const r = data[idx];
                        const g = data[idx + 1];
                        const b = data[idx + 2];
                        
                        totalPixels++;
                        
                        // ìƒ‰ìƒ ê·¸ë£¹í™”
                        const colorKey = `${Math.floor(r/64)*64},${Math.floor(g/64)*64},${Math.floor(b/64)*64}`;
                        colorCounts[colorKey] = (colorCounts[colorKey] || 0) + 1;
                        
                        // ê°„ë‹¨í•œ ì—£ì§€ ê°ì§€
                        if (x > startX && y > startY) {
                            const prevIdx = ((y-1) * width + (x-1)) * 4;
                            const diff = Math.abs(r - data[prevIdx]) + Math.abs(g - data[prevIdx + 1]) + Math.abs(b - data[prevIdx + 2]);
                            if (diff > 60) edgePixels++;
                        }
                    }
                }
                
                // UI íŠ¹ì„± ê³„ì‚°
                const maxColorCount = Math.max(...Object.values(colorCounts));
                const uniformityScore = maxColorCount / totalPixels;
                const edgeScore = edgePixels / totalPixels;
                
                // UI ì ìˆ˜ (ê· ì¼ë„ê°€ ë†’ê³  ì—£ì§€ê°€ ë§ìœ¼ë©´ UI ê°€ëŠ¥ì„± ë†’ìŒ)
                const uiScore = (uniformityScore * 0.7 + edgeScore * 0.3) * 100;
                return Math.min(uiScore, 100);
            }
            
            updateDetectionGrid(scores) {
                scores.forEach((score, idx) => {
                    const cell = document.getElementById(`smart-cell-${idx}`);
                    const scoreSpan = document.getElementById(`smart-score-${idx}`);
                    
                    if (cell && scoreSpan) {
                        scoreSpan.textContent = Math.floor(score) + '%';
                        
                        if (score > 50) {
                            cell.style.borderColor = '#e74c3c';
                            cell.style.backgroundColor = 'rgba(231, 76, 60, 0.2)';
                        } else {
                            cell.style.borderColor = 'transparent';
                            cell.style.backgroundColor = '#0f3460';
                        }
                    }
                });
            }
            
            drawAnalysisOverlay(scores) {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                const cellWidth = this.canvas.width / 3;
                const cellHeight = this.canvas.height / 3;
                
                for (let row = 0; row < 3; row++) {
                    for (let col = 0; col < 3; col++) {
                        const idx = row * 3 + col;
                        const score = scores[idx];
                        
                        const x = col * cellWidth;
                        const y = row * cellHeight;
                        
                        // ê·¸ë¦¬ë“œ ë¼ì¸
                        this.ctx.strokeStyle = '#f39c12';
                        this.ctx.lineWidth = 1;
                        this.ctx.strokeRect(x, y, cellWidth, cellHeight);
                        
                        // UI ê°ì§€ ì‹œ ê°•ì¡°
                        if (score > 50) {
                            this.ctx.fillStyle = 'rgba(231, 76, 60, 0.3)';
                            this.ctx.fillRect(x, y, cellWidth, cellHeight);
                        }
                        
                        // ì ìˆ˜ í‘œì‹œ
                        this.ctx.fillStyle = '#fff';
                        this.ctx.font = '16px Arial';
                        this.ctx.fillText(Math.floor(score) + '%', x + 5, y + 20);
                    }
                }
            }
            
            learnUIPattern(startTime, endTime) {
                const pattern = {
                    id: Date.now(),
                    startTime: startTime,
                    endTime: endTime,
                    duration: endTime - startTime,
                    confidence: 0.9,
                    videoName: videoFile ? videoFile.name : 'unknown'
                };
                
                this.uiPatterns.push(pattern);
                this.updateLearnedPatterns();
                
                // ë¸Œë¼ìš°ì € ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ìë™ ì €ì¥
                this.saveToLocalStorage();
            }
            
            saveToLocalStorage() {
                const storageData = {
                    patterns: this.uiPatterns,
                    lastUpdated: new Date().toISOString(),
                    videoName: videoFile ? videoFile.name : 'unknown'
                };
                
                try {
                    localStorage.setItem('smartUIPatterns', JSON.stringify(storageData));
                    updateSmartStatus('âœ… íŒ¨í„´ì´ ë¸Œë¼ìš°ì €ì— ìë™ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } catch (e) {
                    console.warn('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥ ì‹¤íŒ¨:', e);
                }
            }
            
            loadFromLocalStorage() {
                try {
                    const stored = localStorage.getItem('smartUIPatterns');
                    if (stored) {
                        const data = JSON.parse(stored);
                        this.uiPatterns = data.patterns || [];
                        this.updateLearnedPatterns();
                        updateSmartStatus(`ğŸ“‚ ì €ì¥ëœ ${this.uiPatterns.length}ê°œ íŒ¨í„´ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
                        return true;
                    }
                } catch (e) {
                    console.warn('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë¡œë“œ ì‹¤íŒ¨:', e);
                }
                return false;
            }
            
            updateLearnedPatterns() {
                const container = document.getElementById('learnedUIPatterns');
                if (!container) return;
                
                if (this.uiPatterns.length === 0) {
                    container.innerHTML = 'ì•„ì§ í•™ìŠµëœ íŒ¨í„´ì´ ì—†ìŠµë‹ˆë‹¤';
                    return;
                }
                
                container.innerHTML = this.uiPatterns.map((pattern, idx) => `
                    <div style="background: #1a1a2e; padding: 8px; border-radius: 4px; margin: 5px 0; font-size: 12px;">
                        <strong>íŒ¨í„´ ${idx + 1}:</strong> ${formatTime(pattern.startTime)} - ${formatTime(pattern.endTime)}<br>
                        <small>ê¸¸ì´: ${Math.floor(pattern.duration)}ì´ˆ, ì‹ ë¢°ë„: ${Math.floor(pattern.confidence * 100)}%</small>
                    </div>
                `).join('');
            }
            
            updateResults() {
                document.getElementById('smartResults').style.display = 'block';
                document.getElementById('smartTotalUI').textContent = this.uiPatterns.length;
                
                // 15ì´ˆ ì´ìƒ UIë¡œ í•¸ë“œ ê²½ê³„ ì˜ˆì¸¡
                const longUIPatterns = this.uiPatterns.filter(p => p.duration >= 15);
                document.getElementById('smartPredictedHands').textContent = longUIPatterns.length;
            }
            
            resetGrid() {
                for (let i = 0; i < 9; i++) {
                    const cell = document.getElementById(`smart-cell-${i}`);
                    const score = document.getElementById(`smart-score-${i}`);
                    if (cell) {
                        cell.style.borderColor = 'transparent';
                        cell.style.backgroundColor = '#0f3460';
                    }
                    if (score) score.textContent = '0%';
                }
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
            }
        }
        
        // ìŠ¤ë§ˆíŠ¸ ê°ì§€ í† ê¸€
        function toggleSmartDetection() {
            if (!smartUIDetector) return;
            
            const button = document.getElementById('smartDetectBtn');
            
            if (!smartUIDetector.isDetecting) {
                smartUIDetector.startDetection();
                button.innerHTML = 'ğŸ›‘ UI ê°ì§€ ì¢…ë£Œ';
                button.style.animation = 'pulse 2s infinite';
            } else {
                smartUIDetector.stopDetection();
                button.innerHTML = 'ğŸ” UI ê°ì§€ ì‹œì‘';
                button.style.animation = 'none';
            }
        }
        
        // ìŠ¤ë§ˆíŠ¸ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSmartStatus(message) {
            const status = document.getElementById('smartStatus');
            if (status) {
                status.textContent = message;
            }
        }
        
        // ìŠ¤ë§ˆíŠ¸ ê²°ê³¼ ë‚´ë³´ë‚´ê¸°
        function exportSmartResults() {
            if (!smartUIDetector || smartUIDetector.uiPatterns.length === 0) {
                alert('í•™ìŠµëœ UI íŒ¨í„´ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const results = {
                analysis_type: 'smart_ui_detection',
                video_duration: document.getElementById('smartVideoPlayer').duration,
                ui_patterns: smartUIDetector.uiPatterns,
                predicted_hands: smartUIDetector.uiPatterns.filter(p => p.duration >= 15).map(p => ({
                    estimated_end: Math.max(0, p.startTime - 15),
                    estimated_start: p.endTime + 15,
                    confidence: p.confidence,
                    source_ui: p
                })),
                created_at: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(results, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', 'smart_ui_analysis.json');
            linkElement.click();
            
            updateSmartStatus('âœ… ìŠ¤ë§ˆíŠ¸ ë¶„ì„ ê²°ê³¼ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // CSVë¡œ ë‚´ë³´ë‚´ê¸°
        function exportToCSV() {
            if (!smartUIDetector || smartUIDetector.uiPatterns.length === 0) {
                alert('í•™ìŠµëœ UI íŒ¨í„´ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const csvHeaders = 'ID,ë¹„ë””ì˜¤ëª…,ì‹œì‘ì‹œê°„,ì¢…ë£Œì‹œê°„,ì§€ì†ì‹œê°„,ì‹ ë¢°ë„,ì˜ˆì¸¡í•¸ë“œì¢…ë£Œ,ì˜ˆì¸¡í•¸ë“œì‹œì‘\n';
            const csvRows = smartUIDetector.uiPatterns.map(pattern => {
                const predictedHandEnd = pattern.duration >= 15 ? formatTime(Math.max(0, pattern.startTime - 15)) : 'N/A';
                const predictedHandStart = pattern.duration >= 15 ? formatTime(pattern.endTime + 15) : 'N/A';
                
                return [
                    pattern.id,
                    pattern.videoName || 'unknown',
                    formatTime(pattern.startTime),
                    formatTime(pattern.endTime),
                    `${Math.floor(pattern.duration)}ì´ˆ`,
                    `${Math.floor(pattern.confidence * 100)}%`,
                    predictedHandEnd,
                    predictedHandStart
                ].join(',');
            }).join('\n');
            
            const csvContent = csvHeaders + csvRows;
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', url);
            linkElement.setAttribute('download', 'ui_patterns.csv');
            linkElement.click();
            
            updateSmartStatus('âœ… CSV íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // ì €ì¥ëœ íŒ¨í„´ ì‚­ì œ
        function clearStoredPatterns() {
            if (confirm('ì €ì¥ëœ ëª¨ë“  UI íŒ¨í„´ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('smartUIPatterns');
                if (smartUIDetector) {
                    smartUIDetector.uiPatterns = [];
                    smartUIDetector.updateLearnedPatterns();
                    smartUIDetector.updateResults();
                }
                updateSmartStatus('âœ… ì €ì¥ëœ íŒ¨í„´ì´ ëª¨ë‘ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // íŒ¨í„´ ê°€ì ¸ì˜¤ê¸°
        function importPatterns() {
            document.getElementById('importFile').click();
        }
        
        // ê°€ì ¸ì˜¨ íŒ¨í„´ ë¡œë“œ
        function loadImportedPatterns(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (importedData.ui_patterns && Array.isArray(importedData.ui_patterns)) {
                        if (smartUIDetector) {
                            // ê¸°ì¡´ íŒ¨í„´ê³¼ ë³‘í•©
                            const existingIds = new Set(smartUIDetector.uiPatterns.map(p => p.id));
                            const newPatterns = importedData.ui_patterns.filter(p => !existingIds.has(p.id));
                            
                            smartUIDetector.uiPatterns.push(...newPatterns);
                            smartUIDetector.updateLearnedPatterns();
                            smartUIDetector.updateResults();
                            smartUIDetector.saveToLocalStorage();
                            
                            updateSmartStatus(`âœ… ${newPatterns.length}ê°œì˜ ìƒˆë¡œìš´ íŒ¨í„´ì„ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.`);
                        }
                    } else {
                        alert('ì˜¬ë°”ë¥¸ íŒ¨í„´ íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.');
                    }
                } catch (error) {
                    alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    console.error('Import error:', error);
                }
            };
            reader.readAsText(file);
            
            // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
            event.target.value = '';
        }

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­
        const uploadZone = document.getElementById('uploadZone');
        
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });
        
        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });
        
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type.startsWith('video/')) {
                document.getElementById('videoInput').files = files;
                videoFile = files[0];
                displayVideoInfo(files[0]);
            }
        });
    </script>
</body>
</html>